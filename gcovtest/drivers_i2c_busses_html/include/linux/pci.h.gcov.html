<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - drivers_i2c_busses.info - include/linux/pci.h</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">include/linux</a> - pci.h<span style="font-size: 80%;"> (source / <a href="pci.h.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">drivers_i2c_busses.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">2</td>
            <td class="headerCovTableEntry">2</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2011-04-26</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : /*</a>
<span class="lineNum">       2 </span>                :            :  *      pci.h
<span class="lineNum">       3 </span>                :            :  *
<span class="lineNum">       4 </span>                :            :  *      PCI defines and function prototypes
<span class="lineNum">       5 </span>                :            :  *      Copyright 1994, Drew Eckhardt
<span class="lineNum">       6 </span>                :            :  *      Copyright 1997--1999 Martin Mares &lt;mj@ucw.cz&gt;
<span class="lineNum">       7 </span>                :            :  *
<span class="lineNum">       8 </span>                :            :  *      For more information, please consult the following manuals (look at
<span class="lineNum">       9 </span>                :            :  *      http://www.pcisig.com/ for how to get them):
<span class="lineNum">      10 </span>                :            :  *
<span class="lineNum">      11 </span>                :            :  *      PCI BIOS Specification
<span class="lineNum">      12 </span>                :            :  *      PCI Local Bus Specification
<span class="lineNum">      13 </span>                :            :  *      PCI to PCI Bridge Specification
<span class="lineNum">      14 </span>                :            :  *      PCI System Design Guide
<span class="lineNum">      15 </span>                :            :  */
<span class="lineNum">      16 </span>                :            : 
<span class="lineNum">      17 </span>                :            : #ifndef LINUX_PCI_H
<span class="lineNum">      18 </span>                :            : #define LINUX_PCI_H
<span class="lineNum">      19 </span>                :            : 
<span class="lineNum">      20 </span>                :            : #include &lt;linux/pci_regs.h&gt;       /* The pci register defines */
<span class="lineNum">      21 </span>                :            : 
<span class="lineNum">      22 </span>                :            : /*
<span class="lineNum">      23 </span>                :            :  * The PCI interface treats multi-function devices as independent
<span class="lineNum">      24 </span>                :            :  * devices.  The slot/function address of each device is encoded
<span class="lineNum">      25 </span>                :            :  * in a single byte as follows:
<span class="lineNum">      26 </span>                :            :  *
<span class="lineNum">      27 </span>                :            :  *      7:3 = slot
<span class="lineNum">      28 </span>                :            :  *      2:0 = function
<span class="lineNum">      29 </span>                :            :  */
<span class="lineNum">      30 </span>                :            : #define PCI_DEVFN(slot, func)   ((((slot) &amp; 0x1f) &lt;&lt; 3) | ((func) &amp; 0x07))
<span class="lineNum">      31 </span>                :            : #define PCI_SLOT(devfn)         (((devfn) &gt;&gt; 3) &amp; 0x1f)
<span class="lineNum">      32 </span>                :            : #define PCI_FUNC(devfn)         ((devfn) &amp; 0x07)
<span class="lineNum">      33 </span>                :            : 
<span class="lineNum">      34 </span>                :            : /* Ioctls for /proc/bus/pci/X/Y nodes. */
<span class="lineNum">      35 </span>                :            : #define PCIIOC_BASE             ('P' &lt;&lt; 24 | 'C' &lt;&lt; 16 | 'I' &lt;&lt; 8)
<span class="lineNum">      36 </span>                :            : #define PCIIOC_CONTROLLER       (PCIIOC_BASE | 0x00)    /* Get controller for PCI device. */
<span class="lineNum">      37 </span>                :            : #define PCIIOC_MMAP_IS_IO       (PCIIOC_BASE | 0x01)    /* Set mmap state to I/O space. */
<span class="lineNum">      38 </span>                :            : #define PCIIOC_MMAP_IS_MEM      (PCIIOC_BASE | 0x02)    /* Set mmap state to MEM space. */
<span class="lineNum">      39 </span>                :            : #define PCIIOC_WRITE_COMBINE    (PCIIOC_BASE | 0x03)    /* Enable/disable write-combining. */
<span class="lineNum">      40 </span>                :            : 
<span class="lineNum">      41 </span>                :            : #ifdef __KERNEL__
<span class="lineNum">      42 </span>                :            : 
<span class="lineNum">      43 </span>                :            : #include &lt;linux/mod_devicetable.h&gt;
<span class="lineNum">      44 </span>                :            : 
<span class="lineNum">      45 </span>                :            : #include &lt;linux/types.h&gt;
<span class="lineNum">      46 </span>                :            : #include &lt;linux/init.h&gt;
<span class="lineNum">      47 </span>                :            : #include &lt;linux/ioport.h&gt;
<span class="lineNum">      48 </span>                :            : #include &lt;linux/list.h&gt;
<span class="lineNum">      49 </span>                :            : #include &lt;linux/compiler.h&gt;
<span class="lineNum">      50 </span>                :            : #include &lt;linux/errno.h&gt;
<span class="lineNum">      51 </span>                :            : #include &lt;linux/kobject.h&gt;
<span class="lineNum">      52 </span>                :            : #include &lt;asm/atomic.h&gt;
<span class="lineNum">      53 </span>                :            : #include &lt;linux/device.h&gt;
<span class="lineNum">      54 </span>                :            : #include &lt;linux/io.h&gt;
<span class="lineNum">      55 </span>                :            : #include &lt;linux/irqreturn.h&gt;
<span class="lineNum">      56 </span>                :            : 
<span class="lineNum">      57 </span>                :            : /* Include the ID list */
<span class="lineNum">      58 </span>                :            : #include &lt;linux/pci_ids.h&gt;
<span class="lineNum">      59 </span>                :            : 
<span class="lineNum">      60 </span>                :            : /* pci_slot represents a physical slot */
<span class="lineNum">      61 </span>                :            : struct pci_slot {
<span class="lineNum">      62 </span>                :            :         struct pci_bus *bus;            /* The bus this slot is on */
<span class="lineNum">      63 </span>                :            :         struct list_head list;          /* node in list of slots on this bus */
<span class="lineNum">      64 </span>                :            :         struct hotplug_slot *hotplug;   /* Hotplug info (migrate over time) */
<span class="lineNum">      65 </span>                :            :         unsigned char number;           /* PCI_SLOT(pci_dev-&gt;devfn) */
<span class="lineNum">      66 </span>                :            :         struct kobject kobj;
<span class="lineNum">      67 </span>                :            : };
<span class="lineNum">      68 </span>                :            : 
<span class="lineNum">      69 </span>                :            : static inline const char *pci_slot_name(const struct pci_slot *slot)
<span class="lineNum">      70 </span>                :            : {
<span class="lineNum">      71 </span>                :            :         return kobject_name(&amp;slot-&gt;kobj);
<span class="lineNum">      72 </span>                :            : }
<span class="lineNum">      73 </span>                :            : 
<span class="lineNum">      74 </span>                :            : /* File state for mmap()s on /proc/bus/pci/X/Y */
<span class="lineNum">      75 </span>                :            : enum pci_mmap_state {
<span class="lineNum">      76 </span>                :            :         pci_mmap_io,
<span class="lineNum">      77 </span>                :            :         pci_mmap_mem
<span class="lineNum">      78 </span>                :            : };
<span class="lineNum">      79 </span>                :            : 
<span class="lineNum">      80 </span>                :            : /* This defines the direction arg to the DMA mapping routines. */
<span class="lineNum">      81 </span>                :            : #define PCI_DMA_BIDIRECTIONAL   0
<span class="lineNum">      82 </span>                :            : #define PCI_DMA_TODEVICE        1
<span class="lineNum">      83 </span>                :            : #define PCI_DMA_FROMDEVICE      2
<span class="lineNum">      84 </span>                :            : #define PCI_DMA_NONE            3
<span class="lineNum">      85 </span>                :            : 
<span class="lineNum">      86 </span>                :            : /*
<span class="lineNum">      87 </span>                :            :  *  For PCI devices, the region numbers are assigned this way:
<span class="lineNum">      88 </span>                :            :  */
<span class="lineNum">      89 </span>                :            : enum {
<span class="lineNum">      90 </span>                :            :         /* #0-5: standard PCI resources */
<span class="lineNum">      91 </span>                :            :         PCI_STD_RESOURCES,
<span class="lineNum">      92 </span>                :            :         PCI_STD_RESOURCE_END = 5,
<span class="lineNum">      93 </span>                :            : 
<span class="lineNum">      94 </span>                :            :         /* #6: expansion ROM resource */
<span class="lineNum">      95 </span>                :            :         PCI_ROM_RESOURCE,
<span class="lineNum">      96 </span>                :            : 
<span class="lineNum">      97 </span>                :            :         /* device specific resources */
<span class="lineNum">      98 </span>                :            : #ifdef CONFIG_PCI_IOV
<span class="lineNum">      99 </span>                :            :         PCI_IOV_RESOURCES,
<span class="lineNum">     100 </span>                :            :         PCI_IOV_RESOURCE_END = PCI_IOV_RESOURCES + PCI_SRIOV_NUM_BARS - 1,
<span class="lineNum">     101 </span>                :            : #endif
<span class="lineNum">     102 </span>                :            : 
<span class="lineNum">     103 </span>                :            :         /* resources assigned to buses behind the bridge */
<span class="lineNum">     104 </span>                :            : #define PCI_BRIDGE_RESOURCE_NUM 4
<span class="lineNum">     105 </span>                :            : 
<span class="lineNum">     106 </span>                :            :         PCI_BRIDGE_RESOURCES,
<span class="lineNum">     107 </span>                :            :         PCI_BRIDGE_RESOURCE_END = PCI_BRIDGE_RESOURCES +
<span class="lineNum">     108 </span>                :            :                                   PCI_BRIDGE_RESOURCE_NUM - 1,
<span class="lineNum">     109 </span>                :            : 
<span class="lineNum">     110 </span>                :            :         /* total resources associated with a PCI device */
<span class="lineNum">     111 </span>                :            :         PCI_NUM_RESOURCES,
<span class="lineNum">     112 </span>                :            : 
<span class="lineNum">     113 </span>                :            :         /* preserve this for compatibility */
<span class="lineNum">     114 </span>                :            :         DEVICE_COUNT_RESOURCE
<span class="lineNum">     115 </span>                :            : };
<span class="lineNum">     116 </span>                :            : 
<span class="lineNum">     117 </span>                :            : typedef int __bitwise pci_power_t;
<span class="lineNum">     118 </span>                :            : 
<span class="lineNum">     119 </span>                :            : #define PCI_D0          ((pci_power_t __force) 0)
<span class="lineNum">     120 </span>                :            : #define PCI_D1          ((pci_power_t __force) 1)
<span class="lineNum">     121 </span>                :            : #define PCI_D2          ((pci_power_t __force) 2)
<span class="lineNum">     122 </span>                :            : #define PCI_D3hot       ((pci_power_t __force) 3)
<span class="lineNum">     123 </span>                :            : #define PCI_D3cold      ((pci_power_t __force) 4)
<span class="lineNum">     124 </span>                :            : #define PCI_UNKNOWN     ((pci_power_t __force) 5)
<span class="lineNum">     125 </span>                :            : #define PCI_POWER_ERROR ((pci_power_t __force) -1)
<span class="lineNum">     126 </span>                :            : 
<span class="lineNum">     127 </span>                :            : /* Remember to update this when the list above changes! */
<span class="lineNum">     128 </span>                :            : extern const char *pci_power_names[];
<span class="lineNum">     129 </span>                :            : 
<span class="lineNum">     130 </span>                :            : static inline const char *pci_power_name(pci_power_t state)
<span class="lineNum">     131 </span>                :            : {
<span class="lineNum">     132 </span>                :            :         return pci_power_names[1 + (int) state];
<span class="lineNum">     133 </span>                :            : }
<span class="lineNum">     134 </span>                :            : 
<span class="lineNum">     135 </span>                :            : #define PCI_PM_D2_DELAY 200
<span class="lineNum">     136 </span>                :            : #define PCI_PM_D3_WAIT  10
<span class="lineNum">     137 </span>                :            : #define PCI_PM_BUS_WAIT 50
<span class="lineNum">     138 </span>                :            : 
<span class="lineNum">     139 </span>                :            : /** The pci_channel state describes connectivity between the CPU and
<span class="lineNum">     140 </span>                :            :  *  the pci device.  If some PCI bus between here and the pci device
<span class="lineNum">     141 </span>                :            :  *  has crashed or locked up, this info is reflected here.
<span class="lineNum">     142 </span>                :            :  */
<span class="lineNum">     143 </span>                :            : typedef unsigned int __bitwise pci_channel_state_t;
<span class="lineNum">     144 </span>                :            : 
<span class="lineNum">     145 </span>                :            : enum pci_channel_state {
<span class="lineNum">     146 </span>                :            :         /* I/O channel is in normal state */
<span class="lineNum">     147 </span>                :            :         pci_channel_io_normal = (__force pci_channel_state_t) 1,
<span class="lineNum">     148 </span>                :            : 
<span class="lineNum">     149 </span>                :            :         /* I/O to channel is blocked */
<span class="lineNum">     150 </span>                :            :         pci_channel_io_frozen = (__force pci_channel_state_t) 2,
<span class="lineNum">     151 </span>                :            : 
<span class="lineNum">     152 </span>                :            :         /* PCI card is dead */
<span class="lineNum">     153 </span>                :            :         pci_channel_io_perm_failure = (__force pci_channel_state_t) 3,
<span class="lineNum">     154 </span>                :            : };
<span class="lineNum">     155 </span>                :            : 
<span class="lineNum">     156 </span>                :            : typedef unsigned int __bitwise pcie_reset_state_t;
<span class="lineNum">     157 </span>                :            : 
<span class="lineNum">     158 </span>                :            : enum pcie_reset_state {
<span class="lineNum">     159 </span>                :            :         /* Reset is NOT asserted (Use to deassert reset) */
<span class="lineNum">     160 </span>                :            :         pcie_deassert_reset = (__force pcie_reset_state_t) 1,
<span class="lineNum">     161 </span>                :            : 
<span class="lineNum">     162 </span>                :            :         /* Use #PERST to reset PCI-E device */
<span class="lineNum">     163 </span>                :            :         pcie_warm_reset = (__force pcie_reset_state_t) 2,
<span class="lineNum">     164 </span>                :            : 
<span class="lineNum">     165 </span>                :            :         /* Use PCI-E Hot Reset to reset device */
<span class="lineNum">     166 </span>                :            :         pcie_hot_reset = (__force pcie_reset_state_t) 3
<span class="lineNum">     167 </span>                :            : };
<span class="lineNum">     168 </span>                :            : 
<span class="lineNum">     169 </span>                :            : typedef unsigned short __bitwise pci_dev_flags_t;
<span class="lineNum">     170 </span>                :            : enum pci_dev_flags {
<span class="lineNum">     171 </span>                :            :         /* INTX_DISABLE in PCI_COMMAND register disables MSI
<span class="lineNum">     172 </span>                :            :          * generation too.
<span class="lineNum">     173 </span>                :            :          */
<span class="lineNum">     174 </span>                :            :         PCI_DEV_FLAGS_MSI_INTX_DISABLE_BUG = (__force pci_dev_flags_t) 1,
<span class="lineNum">     175 </span>                :            :         /* Device configuration is irrevocably lost if disabled into D3 */
<span class="lineNum">     176 </span>                :            :         PCI_DEV_FLAGS_NO_D3 = (__force pci_dev_flags_t) 2,
<span class="lineNum">     177 </span>                :            : };
<span class="lineNum">     178 </span>                :            : 
<span class="lineNum">     179 </span>                :            : enum pci_irq_reroute_variant {
<span class="lineNum">     180 </span>                :            :         INTEL_IRQ_REROUTE_VARIANT = 1,
<span class="lineNum">     181 </span>                :            :         MAX_IRQ_REROUTE_VARIANTS = 3
<span class="lineNum">     182 </span>                :            : };
<span class="lineNum">     183 </span>                :            : 
<span class="lineNum">     184 </span>                :            : typedef unsigned short __bitwise pci_bus_flags_t;
<span class="lineNum">     185 </span>                :            : enum pci_bus_flags {
<span class="lineNum">     186 </span>                :            :         PCI_BUS_FLAGS_NO_MSI   = (__force pci_bus_flags_t) 1,
<span class="lineNum">     187 </span>                :            :         PCI_BUS_FLAGS_NO_MMRBC = (__force pci_bus_flags_t) 2,
<span class="lineNum">     188 </span>                :            : };
<span class="lineNum">     189 </span>                :            : 
<span class="lineNum">     190 </span>                :            : /* Based on the PCI Hotplug Spec, but some values are made up by us */
<span class="lineNum">     191 </span>                :            : enum pci_bus_speed {
<span class="lineNum">     192 </span>                :            :         PCI_SPEED_33MHz                 = 0x00,
<span class="lineNum">     193 </span>                :            :         PCI_SPEED_66MHz                 = 0x01,
<span class="lineNum">     194 </span>                :            :         PCI_SPEED_66MHz_PCIX            = 0x02,
<span class="lineNum">     195 </span>                :            :         PCI_SPEED_100MHz_PCIX           = 0x03,
<span class="lineNum">     196 </span>                :            :         PCI_SPEED_133MHz_PCIX           = 0x04,
<span class="lineNum">     197 </span>                :            :         PCI_SPEED_66MHz_PCIX_ECC        = 0x05,
<span class="lineNum">     198 </span>                :            :         PCI_SPEED_100MHz_PCIX_ECC       = 0x06,
<span class="lineNum">     199 </span>                :            :         PCI_SPEED_133MHz_PCIX_ECC       = 0x07,
<span class="lineNum">     200 </span>                :            :         PCI_SPEED_66MHz_PCIX_266        = 0x09,
<span class="lineNum">     201 </span>                :            :         PCI_SPEED_100MHz_PCIX_266       = 0x0a,
<span class="lineNum">     202 </span>                :            :         PCI_SPEED_133MHz_PCIX_266       = 0x0b,
<span class="lineNum">     203 </span>                :            :         AGP_UNKNOWN                     = 0x0c,
<span class="lineNum">     204 </span>                :            :         AGP_1X                          = 0x0d,
<span class="lineNum">     205 </span>                :            :         AGP_2X                          = 0x0e,
<span class="lineNum">     206 </span>                :            :         AGP_4X                          = 0x0f,
<span class="lineNum">     207 </span>                :            :         AGP_8X                          = 0x10,
<span class="lineNum">     208 </span>                :            :         PCI_SPEED_66MHz_PCIX_533        = 0x11,
<span class="lineNum">     209 </span>                :            :         PCI_SPEED_100MHz_PCIX_533       = 0x12,
<span class="lineNum">     210 </span>                :            :         PCI_SPEED_133MHz_PCIX_533       = 0x13,
<span class="lineNum">     211 </span>                :            :         PCIE_SPEED_2_5GT                = 0x14,
<span class="lineNum">     212 </span>                :            :         PCIE_SPEED_5_0GT                = 0x15,
<span class="lineNum">     213 </span>                :            :         PCIE_SPEED_8_0GT                = 0x16,
<span class="lineNum">     214 </span>                :            :         PCI_SPEED_UNKNOWN               = 0xff,
<span class="lineNum">     215 </span>                :            : };
<span class="lineNum">     216 </span>                :            : 
<span class="lineNum">     217 </span>                :            : struct pci_cap_saved_state {
<span class="lineNum">     218 </span>                :            :         struct hlist_node next;
<span class="lineNum">     219 </span>                :            :         char cap_nr;
<span class="lineNum">     220 </span>                :            :         u32 data[0];
<span class="lineNum">     221 </span>                :            : };
<span class="lineNum">     222 </span>                :            : 
<span class="lineNum">     223 </span>                :            : struct pcie_link_state;
<span class="lineNum">     224 </span>                :            : struct pci_vpd;
<span class="lineNum">     225 </span>                :            : struct pci_sriov;
<span class="lineNum">     226 </span>                :            : struct pci_ats;
<span class="lineNum">     227 </span>                :            : 
<span class="lineNum">     228 </span>                :            : /*
<span class="lineNum">     229 </span>                :            :  * The pci_dev structure is used to describe PCI devices.
<span class="lineNum">     230 </span>                :            :  */
<span class="lineNum">     231 </span>                :            : struct pci_dev {
<span class="lineNum">     232 </span>                :            :         struct list_head bus_list;      /* node in per-bus list */
<span class="lineNum">     233 </span>                :            :         struct pci_bus  *bus;           /* bus this device is on */
<span class="lineNum">     234 </span>                :            :         struct pci_bus  *subordinate;   /* bus this device bridges to */
<span class="lineNum">     235 </span>                :            : 
<span class="lineNum">     236 </span>                :            :         void            *sysdata;       /* hook for sys-specific extension */
<span class="lineNum">     237 </span>                :            :         struct proc_dir_entry *procent; /* device entry in /proc/bus/pci */
<span class="lineNum">     238 </span>                :            :         struct pci_slot *slot;          /* Physical slot this device is in */
<span class="lineNum">     239 </span>                :            : 
<span class="lineNum">     240 </span>                :            :         unsigned int    devfn;          /* encoded device &amp; function index */
<span class="lineNum">     241 </span>                :            :         unsigned short  vendor;
<span class="lineNum">     242 </span>                :            :         unsigned short  device;
<span class="lineNum">     243 </span>                :            :         unsigned short  subsystem_vendor;
<span class="lineNum">     244 </span>                :            :         unsigned short  subsystem_device;
<span class="lineNum">     245 </span>                :            :         unsigned int    class;          /* 3 bytes: (base,sub,prog-if) */
<span class="lineNum">     246 </span>                :            :         u8              revision;       /* PCI revision, low byte of class word */
<span class="lineNum">     247 </span>                :            :         u8              hdr_type;       /* PCI header type (`multi' flag masked out) */
<span class="lineNum">     248 </span>                :            :         u8              pcie_cap;       /* PCI-E capability offset */
<span class="lineNum">     249 </span>                :            :         u8              pcie_type;      /* PCI-E device/port type */
<span class="lineNum">     250 </span>                :            :         u8              rom_base_reg;   /* which config register controls the ROM */
<span class="lineNum">     251 </span>                :            :         u8              pin;            /* which interrupt pin this device uses */
<span class="lineNum">     252 </span>                :            : 
<span class="lineNum">     253 </span>                :            :         struct pci_driver *driver;      /* which driver has allocated this device */
<span class="lineNum">     254 </span>                :            :         u64             dma_mask;       /* Mask of the bits of bus address this
<span class="lineNum">     255 </span>                :            :                                            device implements.  Normally this is
<span class="lineNum">     256 </span>                :            :                                            0xffffffff.  You only need to change
<span class="lineNum">     257 </span>                :            :                                            this if your device has broken DMA
<span class="lineNum">     258 </span>                :            :                                            or supports 64-bit transfers.  */
<span class="lineNum">     259 </span>                :            : 
<span class="lineNum">     260 </span>                :            :         struct device_dma_parameters dma_parms;
<span class="lineNum">     261 </span>                :            : 
<span class="lineNum">     262 </span>                :            :         pci_power_t     current_state;  /* Current operating state. In ACPI-speak,
<span class="lineNum">     263 </span>                :            :                                            this is D0-D3, D0 being fully functional,
<span class="lineNum">     264 </span>                :            :                                            and D3 being off. */
<span class="lineNum">     265 </span>                :            :         int             pm_cap;         /* PM capability offset in the
<span class="lineNum">     266 </span>                :            :                                            configuration space */
<span class="lineNum">     267 </span>                :            :         unsigned int    pme_support:5;  /* Bitmask of states from which PME#
<span class="lineNum">     268 </span>                :            :                                            can be generated */
<span class="lineNum">     269 </span>                :            :         unsigned int    pme_interrupt:1;
<span class="lineNum">     270 </span>                :            :         unsigned int    d1_support:1;   /* Low power state D1 is supported */
<span class="lineNum">     271 </span>                :            :         unsigned int    d2_support:1;   /* Low power state D2 is supported */
<span class="lineNum">     272 </span>                :            :         unsigned int    no_d1d2:1;      /* Only allow D0 and D3 */
<span class="lineNum">     273 </span>                :            :         unsigned int    mmio_always_on:1;       /* disallow turning off io/mem
<span class="lineNum">     274 </span>                :            :                                                    decoding during bar sizing */
<span class="lineNum">     275 </span>                :            :         unsigned int    wakeup_prepared:1;
<span class="lineNum">     276 </span>                :            :         unsigned int    d3_delay;       /* D3-&gt;D0 transition time in ms */
<span class="lineNum">     277 </span>                :            : 
<span class="lineNum">     278 </span>                :            : #ifdef CONFIG_PCIEASPM
<span class="lineNum">     279 </span>                :            :         struct pcie_link_state  *link_state;    /* ASPM link state. */
<span class="lineNum">     280 </span>                :            : #endif
<span class="lineNum">     281 </span>                :            : 
<span class="lineNum">     282 </span>                :            :         pci_channel_state_t error_state;        /* current connectivity state */
<span class="lineNum">     283 </span>                :            :         struct  device  dev;            /* Generic device interface */
<span class="lineNum">     284 </span>                :            : 
<span class="lineNum">     285 </span>                :            :         int             cfg_size;       /* Size of configuration space */
<span class="lineNum">     286 </span>                :            : 
<span class="lineNum">     287 </span>                :            :         /*
<span class="lineNum">     288 </span>                :            :          * Instead of touching interrupt line and base address registers
<span class="lineNum">     289 </span>                :            :          * directly, use the values stored here. They might be different!
<span class="lineNum">     290 </span>                :            :          */
<span class="lineNum">     291 </span>                :            :         unsigned int    irq;
<span class="lineNum">     292 </span>                :            :         struct resource resource[DEVICE_COUNT_RESOURCE]; /* I/O and memory regions + expansion ROMs */
<span class="lineNum">     293 </span>                :            :         resource_size_t fw_addr[DEVICE_COUNT_RESOURCE]; /* FW-assigned addr */
<span class="lineNum">     294 </span>                :            : 
<span class="lineNum">     295 </span>                :            :         /* These fields are used by common fixups */
<span class="lineNum">     296 </span>                :            :         unsigned int    transparent:1;  /* Transparent PCI bridge */
<span class="lineNum">     297 </span>                :            :         unsigned int    multifunction:1;/* Part of multi-function device */
<span class="lineNum">     298 </span>                :            :         /* keep track of device state */
<span class="lineNum">     299 </span>                :            :         unsigned int    is_added:1;
<span class="lineNum">     300 </span>                :            :         unsigned int    is_busmaster:1; /* device is busmaster */
<span class="lineNum">     301 </span>                :            :         unsigned int    no_msi:1;       /* device may not use msi */
<span class="lineNum">     302 </span>                :            :         unsigned int    block_ucfg_access:1;    /* userspace config space access is blocked */
<span class="lineNum">     303 </span>                :            :         unsigned int    broken_parity_status:1; /* Device generates false positive parity */
<span class="lineNum">     304 </span>                :            :         unsigned int    irq_reroute_variant:2;  /* device needs IRQ rerouting variant */
<span class="lineNum">     305 </span>                :            :         unsigned int    msi_enabled:1;
<span class="lineNum">     306 </span>                :            :         unsigned int    msix_enabled:1;
<span class="lineNum">     307 </span>                :            :         unsigned int    ari_enabled:1;  /* ARI forwarding */
<span class="lineNum">     308 </span>                :            :         unsigned int    is_managed:1;
<span class="lineNum">     309 </span>                :            :         unsigned int    is_pcie:1;      /* Obsolete. Will be removed.
<span class="lineNum">     310 </span>                :            :                                            Use pci_is_pcie() instead */
<span class="lineNum">     311 </span>                :            :         unsigned int    needs_freset:1; /* Dev requires fundamental reset */
<span class="lineNum">     312 </span>                :            :         unsigned int    state_saved:1;
<span class="lineNum">     313 </span>                :            :         unsigned int    is_physfn:1;
<span class="lineNum">     314 </span>                :            :         unsigned int    is_virtfn:1;
<span class="lineNum">     315 </span>                :            :         unsigned int    reset_fn:1;
<span class="lineNum">     316 </span>                :            :         unsigned int    is_hotplug_bridge:1;
<span class="lineNum">     317 </span>                :            :         unsigned int    __aer_firmware_first_valid:1;
<span class="lineNum">     318 </span>                :            :         unsigned int    __aer_firmware_first:1;
<span class="lineNum">     319 </span>                :            :         pci_dev_flags_t dev_flags;
<span class="lineNum">     320 </span>                :            :         atomic_t        enable_cnt;     /* pci_enable_device has been called */
<span class="lineNum">     321 </span>                :            : 
<span class="lineNum">     322 </span>                :            :         u32             saved_config_space[16]; /* config space saved at suspend time */
<span class="lineNum">     323 </span>                :            :         struct hlist_head saved_cap_space;
<span class="lineNum">     324 </span>                :            :         struct bin_attribute *rom_attr; /* attribute descriptor for sysfs ROM entry */
<span class="lineNum">     325 </span>                :            :         int rom_attr_enabled;           /* has display of the rom attribute been enabled? */
<span class="lineNum">     326 </span>                :            :         struct bin_attribute *res_attr[DEVICE_COUNT_RESOURCE]; /* sysfs file for resources */
<span class="lineNum">     327 </span>                :            :         struct bin_attribute *res_attr_wc[DEVICE_COUNT_RESOURCE]; /* sysfs file for WC mapping of resources */
<span class="lineNum">     328 </span>                :            : #ifdef CONFIG_PCI_MSI
<span class="lineNum">     329 </span>                :            :         struct list_head msi_list;
<span class="lineNum">     330 </span>                :            : #endif
<span class="lineNum">     331 </span>                :            :         struct pci_vpd *vpd;
<span class="lineNum">     332 </span>                :            : #ifdef CONFIG_PCI_IOV
<span class="lineNum">     333 </span>                :            :         union {
<span class="lineNum">     334 </span>                :            :                 struct pci_sriov *sriov;        /* SR-IOV capability related */
<span class="lineNum">     335 </span>                :            :                 struct pci_dev *physfn; /* the PF this VF is associated with */
<span class="lineNum">     336 </span>                :            :         };
<span class="lineNum">     337 </span>                :            :         struct pci_ats  *ats;   /* Address Translation Service */
<span class="lineNum">     338 </span>                :            : #endif
<span class="lineNum">     339 </span>                :            : };
<span class="lineNum">     340 </span>                :            : 
<span class="lineNum">     341 </span>                :            : static inline struct pci_dev *pci_physfn(struct pci_dev *dev)
<span class="lineNum">     342 </span>                :            : {
<span class="lineNum">     343 </span>                :            : #ifdef CONFIG_PCI_IOV
<span class="lineNum">     344 </span>                :            :         if (dev-&gt;is_virtfn)
<span class="lineNum">     345 </span>                :            :                 dev = dev-&gt;physfn;
<span class="lineNum">     346 </span>                :            : #endif
<span class="lineNum">     347 </span>                :            : 
<span class="lineNum">     348 </span>                :            :         return dev;
<span class="lineNum">     349 </span>                :            : }
<span class="lineNum">     350 </span>                :            : 
<span class="lineNum">     351 </span>                :            : extern struct pci_dev *alloc_pci_dev(void);
<span class="lineNum">     352 </span>                :            : 
<span class="lineNum">     353 </span>                :            : #define pci_dev_b(n) list_entry(n, struct pci_dev, bus_list)
<span class="lineNum">     354 </span>                :            : #define to_pci_dev(n) container_of(n, struct pci_dev, dev)
<span class="lineNum">     355 </span>                :            : #define for_each_pci_dev(d) while ((d = pci_get_device(PCI_ANY_ID, PCI_ANY_ID, d)) != NULL)
<span class="lineNum">     356 </span>                :            : 
<span class="lineNum">     357 </span>                :            : static inline int pci_channel_offline(struct pci_dev *pdev)
<span class="lineNum">     358 </span>                :            : {
<span class="lineNum">     359 </span>                :            :         return (pdev-&gt;error_state != pci_channel_io_normal);
<span class="lineNum">     360 </span>                :            : }
<span class="lineNum">     361 </span>                :            : 
<span class="lineNum">     362 </span>                :            : static inline struct pci_cap_saved_state *pci_find_saved_cap(
<span class="lineNum">     363 </span>                :            :         struct pci_dev *pci_dev, char cap)
<span class="lineNum">     364 </span>                :            : {
<span class="lineNum">     365 </span>                :            :         struct pci_cap_saved_state *tmp;
<span class="lineNum">     366 </span>                :            :         struct hlist_node *pos;
<span class="lineNum">     367 </span>                :            : 
<span class="lineNum">     368 </span>                :            :         hlist_for_each_entry(tmp, pos, &amp;pci_dev-&gt;saved_cap_space, next) {
<span class="lineNum">     369 </span>                :            :                 if (tmp-&gt;cap_nr == cap)
<span class="lineNum">     370 </span>                :            :                         return tmp;
<span class="lineNum">     371 </span>                :            :         }
<span class="lineNum">     372 </span>                :            :         return NULL;
<span class="lineNum">     373 </span>                :            : }
<span class="lineNum">     374 </span>                :            : 
<span class="lineNum">     375 </span>                :            : static inline void pci_add_saved_cap(struct pci_dev *pci_dev,
<span class="lineNum">     376 </span>                :            :         struct pci_cap_saved_state *new_cap)
<span class="lineNum">     377 </span>                :            : {
<span class="lineNum">     378 </span>                :            :         hlist_add_head(&amp;new_cap-&gt;next, &amp;pci_dev-&gt;saved_cap_space);
<span class="lineNum">     379 </span>                :            : }
<span class="lineNum">     380 </span>                :            : 
<span class="lineNum">     381 </span>                :            : /*
<span class="lineNum">     382 </span>                :            :  * The first PCI_BRIDGE_RESOURCE_NUM PCI bus resources (those that correspond
<span class="lineNum">     383 </span>                :            :  * to P2P or CardBus bridge windows) go in a table.  Additional ones (for
<span class="lineNum">     384 </span>                :            :  * buses below host bridges or subtractive decode bridges) go in the list.
<span class="lineNum">     385 </span>                :            :  * Use pci_bus_for_each_resource() to iterate through all the resources.
<span class="lineNum">     386 </span>                :            :  */
<span class="lineNum">     387 </span>                :            : 
<span class="lineNum">     388 </span>                :            : /*
<span class="lineNum">     389 </span>                :            :  * PCI_SUBTRACTIVE_DECODE means the bridge forwards the window implicitly
<span class="lineNum">     390 </span>                :            :  * and there's no way to program the bridge with the details of the window.
<span class="lineNum">     391 </span>                :            :  * This does not apply to ACPI _CRS windows, even with the _DEC subtractive-
<span class="lineNum">     392 </span>                :            :  * decode bit set, because they are explicit and can be programmed with _SRS.
<span class="lineNum">     393 </span>                :            :  */
<span class="lineNum">     394 </span>                :            : #define PCI_SUBTRACTIVE_DECODE  0x1
<span class="lineNum">     395 </span>                :            : 
<span class="lineNum">     396 </span>                :            : struct pci_bus_resource {
<span class="lineNum">     397 </span>                :            :         struct list_head list;
<span class="lineNum">     398 </span>                :            :         struct resource *res;
<span class="lineNum">     399 </span>                :            :         unsigned int flags;
<span class="lineNum">     400 </span>                :            : };
<span class="lineNum">     401 </span>                :            : 
<span class="lineNum">     402 </span>                :            : #define PCI_REGION_FLAG_MASK    0x0fU   /* These bits of resource flags tell us the PCI region flags */
<span class="lineNum">     403 </span>                :            : 
<span class="lineNum">     404 </span>                :            : struct pci_bus {
<span class="lineNum">     405 </span>                :            :         struct list_head node;          /* node in list of buses */
<span class="lineNum">     406 </span>                :            :         struct pci_bus  *parent;        /* parent bus this bridge is on */
<span class="lineNum">     407 </span>                :            :         struct list_head children;      /* list of child buses */
<span class="lineNum">     408 </span>                :            :         struct list_head devices;       /* list of devices on this bus */
<span class="lineNum">     409 </span>                :            :         struct pci_dev  *self;          /* bridge device as seen by parent */
<span class="lineNum">     410 </span>                :            :         struct list_head slots;         /* list of slots on this bus */
<span class="lineNum">     411 </span>                :            :         struct resource *resource[PCI_BRIDGE_RESOURCE_NUM];
<span class="lineNum">     412 </span>                :            :         struct list_head resources;     /* address space routed to this bus */
<span class="lineNum">     413 </span>                :            : 
<span class="lineNum">     414 </span>                :            :         struct pci_ops  *ops;           /* configuration access functions */
<span class="lineNum">     415 </span>                :            :         void            *sysdata;       /* hook for sys-specific extension */
<span class="lineNum">     416 </span>                :            :         struct proc_dir_entry *procdir; /* directory entry in /proc/bus/pci */
<span class="lineNum">     417 </span>                :            : 
<span class="lineNum">     418 </span>                :            :         unsigned char   number;         /* bus number */
<span class="lineNum">     419 </span>                :            :         unsigned char   primary;        /* number of primary bridge */
<span class="lineNum">     420 </span>                :            :         unsigned char   secondary;      /* number of secondary bridge */
<span class="lineNum">     421 </span>                :            :         unsigned char   subordinate;    /* max number of subordinate buses */
<span class="lineNum">     422 </span>                :            :         unsigned char   max_bus_speed;  /* enum pci_bus_speed */
<span class="lineNum">     423 </span>                :            :         unsigned char   cur_bus_speed;  /* enum pci_bus_speed */
<span class="lineNum">     424 </span>                :            : 
<span class="lineNum">     425 </span>                :            :         char            name[48];
<span class="lineNum">     426 </span>                :            : 
<span class="lineNum">     427 </span>                :            :         unsigned short  bridge_ctl;     /* manage NO_ISA/FBB/et al behaviors */
<span class="lineNum">     428 </span>                :            :         pci_bus_flags_t bus_flags;      /* Inherited by child busses */
<span class="lineNum">     429 </span>                :            :         struct device           *bridge;
<span class="lineNum">     430 </span>                :            :         struct device           dev;
<span class="lineNum">     431 </span>                :            :         struct bin_attribute    *legacy_io; /* legacy I/O for this bus */
<span class="lineNum">     432 </span>                :            :         struct bin_attribute    *legacy_mem; /* legacy mem */
<span class="lineNum">     433 </span>                :            :         unsigned int            is_added:1;
<span class="lineNum">     434 </span>                :            : };
<span class="lineNum">     435 </span>                :            : 
<span class="lineNum">     436 </span>                :            : #define pci_bus_b(n)    list_entry(n, struct pci_bus, node)
<span class="lineNum">     437 </span>                :            : #define to_pci_bus(n)   container_of(n, struct pci_bus, dev)
<span class="lineNum">     438 </span>                :            : 
<span class="lineNum">     439 </span>                :            : /*
<span class="lineNum">     440 </span>                :            :  * Returns true if the pci bus is root (behind host-pci bridge),
<span class="lineNum">     441 </span>                :            :  * false otherwise
<span class="lineNum">     442 </span>                :            :  */
<span class="lineNum">     443 </span>                :            : static inline bool pci_is_root_bus(struct pci_bus *pbus)
<span class="lineNum">     444 </span>                :            : {
<span class="lineNum">     445 </span>                :            :         return !(pbus-&gt;parent);
<span class="lineNum">     446 </span>                :            : }
<span class="lineNum">     447 </span>                :            : 
<span class="lineNum">     448 </span>                :            : #ifdef CONFIG_PCI_MSI
<span class="lineNum">     449 </span>                :            : static inline bool pci_dev_msi_enabled(struct pci_dev *pci_dev)
<span class="lineNum">     450 </span>                :            : {
<span class="lineNum">     451 </span>                :            :         return pci_dev-&gt;msi_enabled || pci_dev-&gt;msix_enabled;
<span class="lineNum">     452 </span>                :            : }
<span class="lineNum">     453 </span>                :            : #else
<span class="lineNum">     454 </span>                :            : static inline bool pci_dev_msi_enabled(struct pci_dev *pci_dev) { return false; }
<span class="lineNum">     455 </span>                :            : #endif
<span class="lineNum">     456 </span>                :            : 
<span class="lineNum">     457 </span>                :            : /*
<span class="lineNum">     458 </span>                :            :  * Error values that may be returned by PCI functions.
<span class="lineNum">     459 </span>                :            :  */
<span class="lineNum">     460 </span>                :            : #define PCIBIOS_SUCCESSFUL              0x00
<span class="lineNum">     461 </span>                :            : #define PCIBIOS_FUNC_NOT_SUPPORTED      0x81
<span class="lineNum">     462 </span>                :            : #define PCIBIOS_BAD_VENDOR_ID           0x83
<span class="lineNum">     463 </span>                :            : #define PCIBIOS_DEVICE_NOT_FOUND        0x86
<span class="lineNum">     464 </span>                :            : #define PCIBIOS_BAD_REGISTER_NUMBER     0x87
<span class="lineNum">     465 </span>                :            : #define PCIBIOS_SET_FAILED              0x88
<span class="lineNum">     466 </span>                :            : #define PCIBIOS_BUFFER_TOO_SMALL        0x89
<span class="lineNum">     467 </span>                :            : 
<span class="lineNum">     468 </span>                :            : /* Low-level architecture-dependent routines */
<span class="lineNum">     469 </span>                :            : 
<span class="lineNum">     470 </span>                :            : struct pci_ops {
<span class="lineNum">     471 </span>                :            :         int (*read)(struct pci_bus *bus, unsigned int devfn, int where, int size, u32 *val);
<span class="lineNum">     472 </span>                :            :         int (*write)(struct pci_bus *bus, unsigned int devfn, int where, int size, u32 val);
<span class="lineNum">     473 </span>                :            : };
<span class="lineNum">     474 </span>                :            : 
<span class="lineNum">     475 </span>                :            : /*
<span class="lineNum">     476 </span>                :            :  * ACPI needs to be able to access PCI config space before we've done a
<span class="lineNum">     477 </span>                :            :  * PCI bus scan and created pci_bus structures.
<span class="lineNum">     478 </span>                :            :  */
<span class="lineNum">     479 </span>                :            : extern int raw_pci_read(unsigned int domain, unsigned int bus,
<span class="lineNum">     480 </span>                :            :                         unsigned int devfn, int reg, int len, u32 *val);
<span class="lineNum">     481 </span>                :            : extern int raw_pci_write(unsigned int domain, unsigned int bus,
<span class="lineNum">     482 </span>                :            :                         unsigned int devfn, int reg, int len, u32 val);
<span class="lineNum">     483 </span>                :            : 
<span class="lineNum">     484 </span>                :            : struct pci_bus_region {
<span class="lineNum">     485 </span>                :            :         resource_size_t start;
<span class="lineNum">     486 </span>                :            :         resource_size_t end;
<span class="lineNum">     487 </span>                :            : };
<span class="lineNum">     488 </span>                :            : 
<span class="lineNum">     489 </span>                :            : struct pci_dynids {
<span class="lineNum">     490 </span>                :            :         spinlock_t lock;            /* protects list, index */
<span class="lineNum">     491 </span>                :            :         struct list_head list;      /* for IDs added at runtime */
<span class="lineNum">     492 </span>                :            : };
<span class="lineNum">     493 </span>                :            : 
<span class="lineNum">     494 </span>                :            : /* ---------------------------------------------------------------- */
<span class="lineNum">     495 </span>                :            : /** PCI Error Recovery System (PCI-ERS).  If a PCI device driver provides
<span class="lineNum">     496 </span>                :            :  *  a set of callbacks in struct pci_error_handlers, then that device driver
<span class="lineNum">     497 </span>                :            :  *  will be notified of PCI bus errors, and will be driven to recovery
<span class="lineNum">     498 </span>                :            :  *  when an error occurs.
<span class="lineNum">     499 </span>                :            :  */
<span class="lineNum">     500 </span>                :            : 
<span class="lineNum">     501 </span>                :            : typedef unsigned int __bitwise pci_ers_result_t;
<span class="lineNum">     502 </span>                :            : 
<span class="lineNum">     503 </span>                :            : enum pci_ers_result {
<span class="lineNum">     504 </span>                :            :         /* no result/none/not supported in device driver */
<span class="lineNum">     505 </span>                :            :         PCI_ERS_RESULT_NONE = (__force pci_ers_result_t) 1,
<span class="lineNum">     506 </span>                :            : 
<span class="lineNum">     507 </span>                :            :         /* Device driver can recover without slot reset */
<span class="lineNum">     508 </span>                :            :         PCI_ERS_RESULT_CAN_RECOVER = (__force pci_ers_result_t) 2,
<span class="lineNum">     509 </span>                :            : 
<span class="lineNum">     510 </span>                :            :         /* Device driver wants slot to be reset. */
<span class="lineNum">     511 </span>                :            :         PCI_ERS_RESULT_NEED_RESET = (__force pci_ers_result_t) 3,
<span class="lineNum">     512 </span>                :            : 
<span class="lineNum">     513 </span>                :            :         /* Device has completely failed, is unrecoverable */
<span class="lineNum">     514 </span>                :            :         PCI_ERS_RESULT_DISCONNECT = (__force pci_ers_result_t) 4,
<span class="lineNum">     515 </span>                :            : 
<span class="lineNum">     516 </span>                :            :         /* Device driver is fully recovered and operational */
<span class="lineNum">     517 </span>                :            :         PCI_ERS_RESULT_RECOVERED = (__force pci_ers_result_t) 5,
<span class="lineNum">     518 </span>                :            : };
<span class="lineNum">     519 </span>                :            : 
<span class="lineNum">     520 </span>                :            : /* PCI bus error event callbacks */
<span class="lineNum">     521 </span>                :            : struct pci_error_handlers {
<span class="lineNum">     522 </span>                :            :         /* PCI bus error detected on this device */
<span class="lineNum">     523 </span>                :            :         pci_ers_result_t (*error_detected)(struct pci_dev *dev,
<span class="lineNum">     524 </span>                :            :                                            enum pci_channel_state error);
<span class="lineNum">     525 </span>                :            : 
<span class="lineNum">     526 </span>                :            :         /* MMIO has been re-enabled, but not DMA */
<span class="lineNum">     527 </span>                :            :         pci_ers_result_t (*mmio_enabled)(struct pci_dev *dev);
<span class="lineNum">     528 </span>                :            : 
<span class="lineNum">     529 </span>                :            :         /* PCI Express link has been reset */
<span class="lineNum">     530 </span>                :            :         pci_ers_result_t (*link_reset)(struct pci_dev *dev);
<span class="lineNum">     531 </span>                :            : 
<span class="lineNum">     532 </span>                :            :         /* PCI slot has been reset */
<span class="lineNum">     533 </span>                :            :         pci_ers_result_t (*slot_reset)(struct pci_dev *dev);
<span class="lineNum">     534 </span>                :            : 
<span class="lineNum">     535 </span>                :            :         /* Device driver may resume normal operations */
<span class="lineNum">     536 </span>                :            :         void (*resume)(struct pci_dev *dev);
<span class="lineNum">     537 </span>                :            : };
<span class="lineNum">     538 </span>                :            : 
<span class="lineNum">     539 </span>                :            : /* ---------------------------------------------------------------- */
<span class="lineNum">     540 </span>                :            : 
<span class="lineNum">     541 </span>                :            : struct module;
<span class="lineNum">     542 </span>                :            : struct pci_driver {
<span class="lineNum">     543 </span>                :            :         struct list_head node;
<span class="lineNum">     544 </span>                :            :         char *name;
<span class="lineNum">     545 </span>                :            :         const struct pci_device_id *id_table;   /* must be non-NULL for probe to be called */
<span class="lineNum">     546 </span>                :            :         int  (*probe)  (struct pci_dev *dev, const struct pci_device_id *id);   /* New device inserted */
<span class="lineNum">     547 </span>                :            :         void (*remove) (struct pci_dev *dev);   /* Device removed (NULL if not a hot-plug capable driver) */
<span class="lineNum">     548 </span>                :            :         int  (*suspend) (struct pci_dev *dev, pm_message_t state);      /* Device suspended */
<span class="lineNum">     549 </span>                :            :         int  (*suspend_late) (struct pci_dev *dev, pm_message_t state);
<span class="lineNum">     550 </span>                :            :         int  (*resume_early) (struct pci_dev *dev);
<span class="lineNum">     551 </span>                :            :         int  (*resume) (struct pci_dev *dev);                   /* Device woken up */
<span class="lineNum">     552 </span>                :            :         void (*shutdown) (struct pci_dev *dev);
<span class="lineNum">     553 </span>                :            :         struct pci_error_handlers *err_handler;
<span class="lineNum">     554 </span>                :            :         struct device_driver    driver;
<span class="lineNum">     555 </span>                :            :         struct pci_dynids dynids;
<span class="lineNum">     556 </span>                :            : };
<span class="lineNum">     557 </span>                :            : 
<span class="lineNum">     558 </span>                :            : #define to_pci_driver(drv) container_of(drv, struct pci_driver, driver)
<span class="lineNum">     559 </span>                :            : 
<span class="lineNum">     560 </span>                :            : /**
<span class="lineNum">     561 </span>                :            :  * DEFINE_PCI_DEVICE_TABLE - macro used to describe a pci device table
<span class="lineNum">     562 </span>                :            :  * @_table: device table name
<span class="lineNum">     563 </span>                :            :  *
<span class="lineNum">     564 </span>                :            :  * This macro is used to create a struct pci_device_id array (a device table)
<span class="lineNum">     565 </span>                :            :  * in a generic manner.
<span class="lineNum">     566 </span>                :            :  */
<span class="lineNum">     567 </span>                :            : #define DEFINE_PCI_DEVICE_TABLE(_table) \
<span class="lineNum">     568 </span>                :            :         const struct pci_device_id _table[] __devinitconst
<span class="lineNum">     569 </span>                :            : 
<span class="lineNum">     570 </span>                :            : /**
<span class="lineNum">     571 </span>                :            :  * PCI_DEVICE - macro used to describe a specific pci device
<span class="lineNum">     572 </span>                :            :  * @vend: the 16 bit PCI Vendor ID
<span class="lineNum">     573 </span>                :            :  * @dev: the 16 bit PCI Device ID
<span class="lineNum">     574 </span>                :            :  *
<span class="lineNum">     575 </span>                :            :  * This macro is used to create a struct pci_device_id that matches a
<span class="lineNum">     576 </span>                :            :  * specific device.  The subvendor and subdevice fields will be set to
<span class="lineNum">     577 </span>                :            :  * PCI_ANY_ID.
<span class="lineNum">     578 </span>                :            :  */
<span class="lineNum">     579 </span>                :            : #define PCI_DEVICE(vend,dev) \
<span class="lineNum">     580 </span>                :            :         .vendor = (vend), .device = (dev), \
<span class="lineNum">     581 </span>                :            :         .subvendor = PCI_ANY_ID, .subdevice = PCI_ANY_ID
<span class="lineNum">     582 </span>                :            : 
<span class="lineNum">     583 </span>                :            : /**
<span class="lineNum">     584 </span>                :            :  * PCI_DEVICE_CLASS - macro used to describe a specific pci device class
<span class="lineNum">     585 </span>                :            :  * @dev_class: the class, subclass, prog-if triple for this device
<span class="lineNum">     586 </span>                :            :  * @dev_class_mask: the class mask for this device
<span class="lineNum">     587 </span>                :            :  *
<span class="lineNum">     588 </span>                :            :  * This macro is used to create a struct pci_device_id that matches a
<span class="lineNum">     589 </span>                :            :  * specific PCI class.  The vendor, device, subvendor, and subdevice
<span class="lineNum">     590 </span>                :            :  * fields will be set to PCI_ANY_ID.
<span class="lineNum">     591 </span>                :            :  */
<span class="lineNum">     592 </span>                :            : #define PCI_DEVICE_CLASS(dev_class,dev_class_mask) \
<span class="lineNum">     593 </span>                :            :         .class = (dev_class), .class_mask = (dev_class_mask), \
<span class="lineNum">     594 </span>                :            :         .vendor = PCI_ANY_ID, .device = PCI_ANY_ID, \
<span class="lineNum">     595 </span>                :            :         .subvendor = PCI_ANY_ID, .subdevice = PCI_ANY_ID
<span class="lineNum">     596 </span>                :            : 
<span class="lineNum">     597 </span>                :            : /**
<span class="lineNum">     598 </span>                :            :  * PCI_VDEVICE - macro used to describe a specific pci device in short form
<span class="lineNum">     599 </span>                :            :  * @vendor: the vendor name
<span class="lineNum">     600 </span>                :            :  * @device: the 16 bit PCI Device ID
<span class="lineNum">     601 </span>                :            :  *
<span class="lineNum">     602 </span>                :            :  * This macro is used to create a struct pci_device_id that matches a
<span class="lineNum">     603 </span>                :            :  * specific PCI device.  The subvendor, and subdevice fields will be set
<span class="lineNum">     604 </span>                :            :  * to PCI_ANY_ID. The macro allows the next field to follow as the device
<span class="lineNum">     605 </span>                :            :  * private data.
<span class="lineNum">     606 </span>                :            :  */
<span class="lineNum">     607 </span>                :            : 
<span class="lineNum">     608 </span>                :            : #define PCI_VDEVICE(vendor, device)             \
<span class="lineNum">     609 </span>                :            :         PCI_VENDOR_ID_##vendor, (device),       \
<span class="lineNum">     610 </span>                :            :         PCI_ANY_ID, PCI_ANY_ID, 0, 0
<span class="lineNum">     611 </span>                :            : 
<span class="lineNum">     612 </span>                :            : /* these external functions are only available when PCI support is enabled */
<span class="lineNum">     613 </span>                :            : #ifdef CONFIG_PCI
<span class="lineNum">     614 </span>                :            : 
<span class="lineNum">     615 </span>                :            : extern struct bus_type pci_bus_type;
<span class="lineNum">     616 </span>                :            : 
<span class="lineNum">     617 </span>                :            : /* Do NOT directly access these two variables, unless you are arch specific pci
<span class="lineNum">     618 </span>                :            :  * code, or pci core code. */
<span class="lineNum">     619 </span>                :            : extern struct list_head pci_root_buses; /* list of all known PCI buses */
<span class="lineNum">     620 </span>                :            : /* Some device drivers need know if pci is initiated */
<span class="lineNum">     621 </span>                :            : extern int no_pci_devices(void);
<span class="lineNum">     622 </span>                :            : 
<span class="lineNum">     623 </span>                :            : void pcibios_fixup_bus(struct pci_bus *);
<span class="lineNum">     624 </span>                :            : int __must_check pcibios_enable_device(struct pci_dev *, int mask);
<span class="lineNum">     625 </span>                :            : char *pcibios_setup(char *str);
<span class="lineNum">     626 </span>                :            : 
<span class="lineNum">     627 </span>                :            : /* Used only when drivers/pci/setup.c is used */
<span class="lineNum">     628 </span>                :            : resource_size_t pcibios_align_resource(void *, const struct resource *,
<span class="lineNum">     629 </span>                :            :                                 resource_size_t,
<span class="lineNum">     630 </span>                :            :                                 resource_size_t);
<span class="lineNum">     631 </span>                :            : void pcibios_update_irq(struct pci_dev *, int irq);
<span class="lineNum">     632 </span>                :            : 
<span class="lineNum">     633 </span>                :            : /* Weak but can be overriden by arch */
<span class="lineNum">     634 </span>                :            : void pci_fixup_cardbus(struct pci_bus *);
<span class="lineNum">     635 </span>                :            : 
<span class="lineNum">     636 </span>                :            : /* Generic PCI functions used internally */
<span class="lineNum">     637 </span>                :            : 
<span class="lineNum">     638 </span>                :            : void pcibios_scan_specific_bus(int busn);
<span class="lineNum">     639 </span>                :            : extern struct pci_bus *pci_find_bus(int domain, int busnr);
<span class="lineNum">     640 </span>                :            : void pci_bus_add_devices(const struct pci_bus *bus);
<span class="lineNum">     641 </span>                :            : struct pci_bus *pci_scan_bus_parented(struct device *parent, int bus,
<span class="lineNum">     642 </span>                :            :                                       struct pci_ops *ops, void *sysdata);
<span class="lineNum">     643 </span>                :            : static inline struct pci_bus * __devinit pci_scan_bus(int bus, struct pci_ops *ops,
<span class="lineNum">     644 </span>                :            :                                            void *sysdata)
<span class="lineNum">     645 </span>                :            : {
<span class="lineNum">     646 </span>                :            :         struct pci_bus *root_bus;
<span class="lineNum">     647 </span>                :            :         root_bus = pci_scan_bus_parented(NULL, bus, ops, sysdata);
<span class="lineNum">     648 </span>                :            :         if (root_bus)
<span class="lineNum">     649 </span>                :            :                 pci_bus_add_devices(root_bus);
<span class="lineNum">     650 </span>                :            :         return root_bus;
<span class="lineNum">     651 </span>                :            : }
<span class="lineNum">     652 </span>                :            : struct pci_bus *pci_create_bus(struct device *parent, int bus,
<span class="lineNum">     653 </span>                :            :                                struct pci_ops *ops, void *sysdata);
<span class="lineNum">     654 </span>                :            : struct pci_bus *pci_add_new_bus(struct pci_bus *parent, struct pci_dev *dev,
<span class="lineNum">     655 </span>                :            :                                 int busnr);
<span class="lineNum">     656 </span>                :            : void pcie_update_link_speed(struct pci_bus *bus, u16 link_status);
<span class="lineNum">     657 </span>                :            : struct pci_slot *pci_create_slot(struct pci_bus *parent, int slot_nr,
<span class="lineNum">     658 </span>                :            :                                  const char *name,
<span class="lineNum">     659 </span>                :            :                                  struct hotplug_slot *hotplug);
<span class="lineNum">     660 </span>                :            : void pci_destroy_slot(struct pci_slot *slot);
<span class="lineNum">     661 </span>                :            : void pci_renumber_slot(struct pci_slot *slot, int slot_nr);
<span class="lineNum">     662 </span>                :            : int pci_scan_slot(struct pci_bus *bus, int devfn);
<span class="lineNum">     663 </span>                :            : struct pci_dev *pci_scan_single_device(struct pci_bus *bus, int devfn);
<span class="lineNum">     664 </span>                :            : void pci_device_add(struct pci_dev *dev, struct pci_bus *bus);
<span class="lineNum">     665 </span>                :            : unsigned int pci_scan_child_bus(struct pci_bus *bus);
<span class="lineNum">     666 </span>                :            : int __must_check pci_bus_add_device(struct pci_dev *dev);
<span class="lineNum">     667 </span>                :            : void pci_read_bridge_bases(struct pci_bus *child);
<span class="lineNum">     668 </span>                :            : struct resource *pci_find_parent_resource(const struct pci_dev *dev,
<span class="lineNum">     669 </span>                :            :                                           struct resource *res);
<span class="lineNum">     670 </span>                :            : u8 pci_swizzle_interrupt_pin(struct pci_dev *dev, u8 pin);
<span class="lineNum">     671 </span>                :            : int pci_get_interrupt_pin(struct pci_dev *dev, struct pci_dev **bridge);
<span class="lineNum">     672 </span>                :            : u8 pci_common_swizzle(struct pci_dev *dev, u8 *pinp);
<span class="lineNum">     673 </span>                :            : extern struct pci_dev *pci_dev_get(struct pci_dev *dev);
<span class="lineNum">     674 </span>                :            : extern void pci_dev_put(struct pci_dev *dev);
<span class="lineNum">     675 </span>                :            : extern void pci_remove_bus(struct pci_bus *b);
<span class="lineNum">     676 </span>                :            : extern void pci_remove_bus_device(struct pci_dev *dev);
<span class="lineNum">     677 </span>                :            : extern void pci_stop_bus_device(struct pci_dev *dev);
<span class="lineNum">     678 </span>                :            : void pci_setup_cardbus(struct pci_bus *bus);
<span class="lineNum">     679 </span>                :            : extern void pci_sort_breadthfirst(void);
<span class="lineNum">     680 </span>                :            : #define dev_is_pci(d) ((d)-&gt;bus == &amp;pci_bus_type)
<span class="lineNum">     681 </span>                :            : #define dev_is_pf(d) ((dev_is_pci(d) ? to_pci_dev(d)-&gt;is_physfn : false))
<span class="lineNum">     682 </span>                :            : #define dev_num_vf(d) ((dev_is_pci(d) ? pci_num_vf(to_pci_dev(d)) : 0))
<span class="lineNum">     683 </span>                :            : 
<span class="lineNum">     684 </span>                :            : /* Generic PCI functions exported to card drivers */
<span class="lineNum">     685 </span>                :            : 
<span class="lineNum">     686 </span>                :            : enum pci_lost_interrupt_reason {
<span class="lineNum">     687 </span>                :            :         PCI_LOST_IRQ_NO_INFORMATION = 0,
<span class="lineNum">     688 </span>                :            :         PCI_LOST_IRQ_DISABLE_MSI,
<span class="lineNum">     689 </span>                :            :         PCI_LOST_IRQ_DISABLE_MSIX,
<span class="lineNum">     690 </span>                :            :         PCI_LOST_IRQ_DISABLE_ACPI,
<span class="lineNum">     691 </span>                :            : };
<span class="lineNum">     692 </span>                :            : enum pci_lost_interrupt_reason pci_lost_interrupt(struct pci_dev *dev);
<span class="lineNum">     693 </span>                :            : int pci_find_capability(struct pci_dev *dev, int cap);
<span class="lineNum">     694 </span>                :            : int pci_find_next_capability(struct pci_dev *dev, u8 pos, int cap);
<span class="lineNum">     695 </span>                :            : int pci_find_ext_capability(struct pci_dev *dev, int cap);
<span class="lineNum">     696 </span>                :            : int pci_bus_find_ext_capability(struct pci_bus *bus, unsigned int devfn,
<span class="lineNum">     697 </span>                :            :                                 int cap);
<span class="lineNum">     698 </span>                :            : int pci_find_ht_capability(struct pci_dev *dev, int ht_cap);
<span class="lineNum">     699 </span>                :            : int pci_find_next_ht_capability(struct pci_dev *dev, int pos, int ht_cap);
<span class="lineNum">     700 </span>                :            : struct pci_bus *pci_find_next_bus(const struct pci_bus *from);
<span class="lineNum">     701 </span>                :            : 
<span class="lineNum">     702 </span>                :            : struct pci_dev *pci_get_device(unsigned int vendor, unsigned int device,
<span class="lineNum">     703 </span>                :            :                                 struct pci_dev *from);
<span class="lineNum">     704 </span>                :            : struct pci_dev *pci_get_subsys(unsigned int vendor, unsigned int device,
<span class="lineNum">     705 </span>                :            :                                 unsigned int ss_vendor, unsigned int ss_device,
<span class="lineNum">     706 </span>                :            :                                 struct pci_dev *from);
<span class="lineNum">     707 </span>                :            : struct pci_dev *pci_get_slot(struct pci_bus *bus, unsigned int devfn);
<span class="lineNum">     708 </span>                :            : struct pci_dev *pci_get_domain_bus_and_slot(int domain, unsigned int bus,
<span class="lineNum">     709 </span>                :            :                                             unsigned int devfn);
<span class="lineNum">     710 </span>                :            : static inline struct pci_dev *pci_get_bus_and_slot(unsigned int bus,
<span class="lineNum">     711 </span>                :            :                                                    unsigned int devfn)
<span class="lineNum">     712 </span>                :            : {
<span class="lineNum">     713 </span>                :            :         return pci_get_domain_bus_and_slot(0, bus, devfn);
<span class="lineNum">     714 </span>                :            : }
<span class="lineNum">     715 </span>                :            : struct pci_dev *pci_get_class(unsigned int class, struct pci_dev *from);
<span class="lineNum">     716 </span>                :            : int pci_dev_present(const struct pci_device_id *ids);
<span class="lineNum">     717 </span>                :            : 
<span class="lineNum">     718 </span>                :            : int pci_bus_read_config_byte(struct pci_bus *bus, unsigned int devfn,
<span class="lineNum">     719 </span>                :            :                              int where, u8 *val);
<span class="lineNum">     720 </span>                :            : int pci_bus_read_config_word(struct pci_bus *bus, unsigned int devfn,
<span class="lineNum">     721 </span>                :            :                              int where, u16 *val);
<span class="lineNum">     722 </span>                :            : int pci_bus_read_config_dword(struct pci_bus *bus, unsigned int devfn,
<span class="lineNum">     723 </span>                :            :                               int where, u32 *val);
<span class="lineNum">     724 </span>                :            : int pci_bus_write_config_byte(struct pci_bus *bus, unsigned int devfn,
<span class="lineNum">     725 </span>                :            :                               int where, u8 val);
<span class="lineNum">     726 </span>                :            : int pci_bus_write_config_word(struct pci_bus *bus, unsigned int devfn,
<span class="lineNum">     727 </span>                :            :                               int where, u16 val);
<span class="lineNum">     728 </span>                :            : int pci_bus_write_config_dword(struct pci_bus *bus, unsigned int devfn,
<span class="lineNum">     729 </span>                :            :                                int where, u32 val);
<span class="lineNum">     730 </span>                :            : struct pci_ops *pci_bus_set_ops(struct pci_bus *bus, struct pci_ops *ops);
<span class="lineNum">     731 </span>                :            : 
<span class="lineNum">     732 </span>                :            : static inline int pci_read_config_byte(struct pci_dev *dev, int where, u8 *val)
<span class="lineNum">     733 </span>                :            : {
<span class="lineNum">     734 </span>                :            :         return pci_bus_read_config_byte(dev-&gt;bus, dev-&gt;devfn, where, val);
<span class="lineNum">     735 </span>                :            : }
<span class="lineNum">     736 </span>                :            : static inline int pci_read_config_word(struct pci_dev *dev, int where, u16 *val)
<span class="lineNum">     737 </span>                :            : {
<span class="lineNum">     738 </span>                :            :         return pci_bus_read_config_word(dev-&gt;bus, dev-&gt;devfn, where, val);
<span class="lineNum">     739 </span>                :            : }
<span class="lineNum">     740 </span>                :            : static inline int pci_read_config_dword(struct pci_dev *dev, int where,
<span class="lineNum">     741 </span>                :            :                                         u32 *val)
<span class="lineNum">     742 </span>                :            : {
<span class="lineNum">     743 </span>                :            :         return pci_bus_read_config_dword(dev-&gt;bus, dev-&gt;devfn, where, val);
<span class="lineNum">     744 </span>                :            : }
<span class="lineNum">     745 </span>                :            : static inline int pci_write_config_byte(struct pci_dev *dev, int where, u8 val)
<span class="lineNum">     746 </span>                :            : {
<span class="lineNum">     747 </span>                :            :         return pci_bus_write_config_byte(dev-&gt;bus, dev-&gt;devfn, where, val);
<span class="lineNum">     748 </span>                :            : }
<span class="lineNum">     749 </span>                :            : static inline int pci_write_config_word(struct pci_dev *dev, int where, u16 val)
<span class="lineNum">     750 </span>                :            : {
<span class="lineNum">     751 </span>                :            :         return pci_bus_write_config_word(dev-&gt;bus, dev-&gt;devfn, where, val);
<span class="lineNum">     752 </span>                :            : }
<span class="lineNum">     753 </span>                :            : static inline int pci_write_config_dword(struct pci_dev *dev, int where,
<span class="lineNum">     754 </span>                :            :                                          u32 val)
<span class="lineNum">     755 </span>                :            : {
<span class="lineNum">     756 </span>                :            :         return pci_bus_write_config_dword(dev-&gt;bus, dev-&gt;devfn, where, val);
<span class="lineNum">     757 </span>                :            : }
<span class="lineNum">     758 </span>                :            : 
<span class="lineNum">     759 </span>                :            : int __must_check pci_enable_device(struct pci_dev *dev);
<span class="lineNum">     760 </span>                :            : int __must_check pci_enable_device_io(struct pci_dev *dev);
<span class="lineNum">     761 </span>                :            : int __must_check pci_enable_device_mem(struct pci_dev *dev);
<span class="lineNum">     762 </span>                :            : int __must_check pci_reenable_device(struct pci_dev *);
<span class="lineNum">     763 </span>                :            : int __must_check pcim_enable_device(struct pci_dev *pdev);
<span class="lineNum">     764 </span>                :            : void pcim_pin_device(struct pci_dev *pdev);
<span class="lineNum">     765 </span>                :            : 
<span class="lineNum">     766 </span>                :            : static inline int pci_is_enabled(struct pci_dev *pdev)
<span class="lineNum">     767 </span>                :            : {
<span class="lineNum">     768 </span>                :            :         return (atomic_read(&amp;pdev-&gt;enable_cnt) &gt; 0);
<span class="lineNum">     769 </span>                :            : }
<span class="lineNum">     770 </span>                :            : 
<span class="lineNum">     771 </span>                :            : static inline int pci_is_managed(struct pci_dev *pdev)
<span class="lineNum">     772 </span>                :            : {
<span class="lineNum">     773 </span>                :            :         return pdev-&gt;is_managed;
<span class="lineNum">     774 </span>                :            : }
<span class="lineNum">     775 </span>                :            : 
<span class="lineNum">     776 </span>                :            : void pci_disable_device(struct pci_dev *dev);
<span class="lineNum">     777 </span>                :            : void pci_set_master(struct pci_dev *dev);
<span class="lineNum">     778 </span>                :            : void pci_clear_master(struct pci_dev *dev);
<span class="lineNum">     779 </span>                :            : int pci_set_pcie_reset_state(struct pci_dev *dev, enum pcie_reset_state state);
<span class="lineNum">     780 </span>                :            : int pci_set_cacheline_size(struct pci_dev *dev);
<span class="lineNum">     781 </span>                :            : #define HAVE_PCI_SET_MWI
<span class="lineNum">     782 </span>                :            : int __must_check pci_set_mwi(struct pci_dev *dev);
<span class="lineNum">     783 </span>                :            : int pci_try_set_mwi(struct pci_dev *dev);
<span class="lineNum">     784 </span>                :            : void pci_clear_mwi(struct pci_dev *dev);
<span class="lineNum">     785 </span>                :            : void pci_intx(struct pci_dev *dev, int enable);
<span class="lineNum">     786 </span>                :            : void pci_msi_off(struct pci_dev *dev);
<span class="lineNum">     787 </span>                :            : int pci_set_dma_max_seg_size(struct pci_dev *dev, unsigned int size);
<span class="lineNum">     788 </span>                :            : int pci_set_dma_seg_boundary(struct pci_dev *dev, unsigned long mask);
<span class="lineNum">     789 </span>                :            : int pcix_get_max_mmrbc(struct pci_dev *dev);
<span class="lineNum">     790 </span>                :            : int pcix_get_mmrbc(struct pci_dev *dev);
<span class="lineNum">     791 </span>                :            : int pcix_set_mmrbc(struct pci_dev *dev, int mmrbc);
<span class="lineNum">     792 </span>                :            : int pcie_get_readrq(struct pci_dev *dev);
<span class="lineNum">     793 </span>                :            : int pcie_set_readrq(struct pci_dev *dev, int rq);
<span class="lineNum">     794 </span>                :            : int __pci_reset_function(struct pci_dev *dev);
<span class="lineNum">     795 </span>                :            : int pci_reset_function(struct pci_dev *dev);
<span class="lineNum">     796 </span>                :            : void pci_update_resource(struct pci_dev *dev, int resno);
<span class="lineNum">     797 </span>                :            : int __must_check pci_assign_resource(struct pci_dev *dev, int i);
<span class="lineNum">     798 </span>                :            : int pci_select_bars(struct pci_dev *dev, unsigned long flags);
<span class="lineNum">     799 </span>                :            : 
<span class="lineNum">     800 </span>                :            : /* ROM control related routines */
<span class="lineNum">     801 </span>                :            : int pci_enable_rom(struct pci_dev *pdev);
<span class="lineNum">     802 </span>                :            : void pci_disable_rom(struct pci_dev *pdev);
<span class="lineNum">     803 </span>                :            : void __iomem __must_check *pci_map_rom(struct pci_dev *pdev, size_t *size);
<span class="lineNum">     804 </span>                :            : void pci_unmap_rom(struct pci_dev *pdev, void __iomem *rom);
<span class="lineNum">     805 </span>                :            : size_t pci_get_rom_size(struct pci_dev *pdev, void __iomem *rom, size_t size);
<span class="lineNum">     806 </span>                :            : 
<span class="lineNum">     807 </span>                :            : /* Power management related routines */
<span class="lineNum">     808 </span>                :            : int pci_save_state(struct pci_dev *dev);
<span class="lineNum">     809 </span>                :            : int pci_restore_state(struct pci_dev *dev);
<span class="lineNum">     810 </span>                :            : int __pci_complete_power_transition(struct pci_dev *dev, pci_power_t state);
<span class="lineNum">     811 </span>                :            : int pci_set_power_state(struct pci_dev *dev, pci_power_t state);
<span class="lineNum">     812 </span>                :            : pci_power_t pci_choose_state(struct pci_dev *dev, pm_message_t state);
<span class="lineNum">     813 </span>                :            : bool pci_pme_capable(struct pci_dev *dev, pci_power_t state);
<span class="lineNum">     814 </span>                :            : void pci_pme_active(struct pci_dev *dev, bool enable);
<span class="lineNum">     815 </span>                :            : int __pci_enable_wake(struct pci_dev *dev, pci_power_t state,
<span class="lineNum">     816 </span>                :            :                       bool runtime, bool enable);
<span class="lineNum">     817 </span>                :            : int pci_wake_from_d3(struct pci_dev *dev, bool enable);
<span class="lineNum">     818 </span>                :            : pci_power_t pci_target_state(struct pci_dev *dev);
<span class="lineNum">     819 </span>                :            : int pci_prepare_to_sleep(struct pci_dev *dev);
<span class="lineNum">     820 </span>                :            : int pci_back_from_sleep(struct pci_dev *dev);
<span class="lineNum">     821 </span>                :            : bool pci_dev_run_wake(struct pci_dev *dev);
<span class="lineNum">     822 </span>                :            : 
<span class="lineNum">     823 </span>                :            : static inline int pci_enable_wake(struct pci_dev *dev, pci_power_t state,
<span class="lineNum">     824 </span>                :            :                                   bool enable)
<span class="lineNum">     825 </span>                :            : {
<span class="lineNum">     826 </span>                :            :         return __pci_enable_wake(dev, state, false, enable);
<span class="lineNum">     827 </span>                :            : }
<span class="lineNum">     828 </span>                :            : 
<span class="lineNum">     829 </span>                :            : /* For use by arch with custom probe code */
<span class="lineNum">     830 </span>                :            : void set_pcie_port_type(struct pci_dev *pdev);
<span class="lineNum">     831 </span>                :            : void set_pcie_hotplug_bridge(struct pci_dev *pdev);
<span class="lineNum">     832 </span>                :            : 
<span class="lineNum">     833 </span>                :            : /* Functions for PCI Hotplug drivers to use */
<span class="lineNum">     834 </span>                :            : int pci_bus_find_capability(struct pci_bus *bus, unsigned int devfn, int cap);
<span class="lineNum">     835 </span>                :            : #ifdef CONFIG_HOTPLUG
<span class="lineNum">     836 </span>                :            : unsigned int pci_rescan_bus(struct pci_bus *bus);
<span class="lineNum">     837 </span>                :            : #endif
<span class="lineNum">     838 </span>                :            : 
<span class="lineNum">     839 </span>                :            : /* Vital product data routines */
<span class="lineNum">     840 </span>                :            : ssize_t pci_read_vpd(struct pci_dev *dev, loff_t pos, size_t count, void *buf);
<span class="lineNum">     841 </span>                :            : ssize_t pci_write_vpd(struct pci_dev *dev, loff_t pos, size_t count, const void *buf);
<span class="lineNum">     842 </span>                :            : int pci_vpd_truncate(struct pci_dev *dev, size_t size);
<span class="lineNum">     843 </span>                :            : 
<span class="lineNum">     844 </span>                :            : /* Helper functions for low-level code (drivers/pci/setup-[bus,res].c) */
<span class="lineNum">     845 </span>                :            : void pci_bus_assign_resources(const struct pci_bus *bus);
<span class="lineNum">     846 </span>                :            : void pci_bus_size_bridges(struct pci_bus *bus);
<span class="lineNum">     847 </span>                :            : int pci_claim_resource(struct pci_dev *, int);
<span class="lineNum">     848 </span>                :            : void pci_assign_unassigned_resources(void);
<span class="lineNum">     849 </span>                :            : void pci_assign_unassigned_bridge_resources(struct pci_dev *bridge);
<span class="lineNum">     850 </span>                :            : void pdev_enable_device(struct pci_dev *);
<span class="lineNum">     851 </span>                :            : void pdev_sort_resources(struct pci_dev *, struct resource_list *);
<span class="lineNum">     852 </span>                :            : int pci_enable_resources(struct pci_dev *, int mask);
<span class="lineNum">     853 </span>                :            : void pci_fixup_irqs(u8 (*)(struct pci_dev *, u8 *),
<span class="lineNum">     854 </span>                :            :                     int (*)(struct pci_dev *, u8, u8));
<span class="lineNum">     855 </span>                :            : #define HAVE_PCI_REQ_REGIONS    2
<span class="lineNum">     856 </span>                :            : int __must_check pci_request_regions(struct pci_dev *, const char *);
<span class="lineNum">     857 </span>                :            : int __must_check pci_request_regions_exclusive(struct pci_dev *, const char *);
<span class="lineNum">     858 </span>                :            : void pci_release_regions(struct pci_dev *);
<span class="lineNum">     859 </span>                :            : int __must_check pci_request_region(struct pci_dev *, int, const char *);
<span class="lineNum">     860 </span>                :            : int __must_check pci_request_region_exclusive(struct pci_dev *, int, const char *);
<span class="lineNum">     861 </span>                :            : void pci_release_region(struct pci_dev *, int);
<span class="lineNum">     862 </span>                :            : int pci_request_selected_regions(struct pci_dev *, int, const char *);
<span class="lineNum">     863 </span>                :            : int pci_request_selected_regions_exclusive(struct pci_dev *, int, const char *);
<span class="lineNum">     864 </span>                :            : void pci_release_selected_regions(struct pci_dev *, int);
<span class="lineNum">     865 </span>                :            : 
<span class="lineNum">     866 </span>                :            : /* drivers/pci/bus.c */
<span class="lineNum">     867 </span>                :            : void pci_bus_add_resource(struct pci_bus *bus, struct resource *res, unsigned int flags);
<span class="lineNum">     868 </span>                :            : struct resource *pci_bus_resource_n(const struct pci_bus *bus, int n);
<span class="lineNum">     869 </span>                :            : void pci_bus_remove_resources(struct pci_bus *bus);
<span class="lineNum">     870 </span>                :            : 
<span class="lineNum">     871 </span>                :            : #define pci_bus_for_each_resource(bus, res, i)                          \
<span class="lineNum">     872 </span>                :            :         for (i = 0;                                                     \
<span class="lineNum">     873 </span>                :            :             (res = pci_bus_resource_n(bus, i)) || i &lt; PCI_BRIDGE_RESOURCE_NUM; \
<span class="lineNum">     874 </span>                :            :              i++)
<span class="lineNum">     875 </span>                :            : 
<span class="lineNum">     876 </span>                :            : int __must_check pci_bus_alloc_resource(struct pci_bus *bus,
<span class="lineNum">     877 </span>                :            :                         struct resource *res, resource_size_t size,
<span class="lineNum">     878 </span>                :            :                         resource_size_t align, resource_size_t min,
<span class="lineNum">     879 </span>                :            :                         unsigned int type_mask,
<span class="lineNum">     880 </span>                :            :                         resource_size_t (*alignf)(void *,
<span class="lineNum">     881 </span>                :            :                                                   const struct resource *,
<span class="lineNum">     882 </span>                :            :                                                   resource_size_t,
<span class="lineNum">     883 </span>                :            :                                                   resource_size_t),
<span class="lineNum">     884 </span>                :            :                         void *alignf_data);
<span class="lineNum">     885 </span>                :            : void pci_enable_bridges(struct pci_bus *bus);
<span class="lineNum">     886 </span>                :            : 
<span class="lineNum">     887 </span>                :            : /* Proper probing supporting hot-pluggable devices */
<span class="lineNum">     888 </span>                :            : int __must_check __pci_register_driver(struct pci_driver *, struct module *,
<span class="lineNum">     889 </span>                :            :                                        const char *mod_name);
<span class="lineNum">     890 </span>                :            : 
<span class="lineNum">     891 </span>                :            : /*
<span class="lineNum">     892 </span>                :            :  * pci_register_driver must be a macro so that KBUILD_MODNAME can be expanded
<span class="lineNum">     893 </span>                :            :  */
<span class="lineNum">     894 </span>                :            : #define pci_register_driver(driver)             \
<span class="lineNum">     895 </span>                :            :         __pci_register_driver(driver, THIS_MODULE, KBUILD_MODNAME)
<span class="lineNum">     896 </span>                :            : 
<span class="lineNum">     897 </span>                :            : void pci_unregister_driver(struct pci_driver *dev);
<span class="lineNum">     898 </span>                :            : void pci_remove_behind_bridge(struct pci_dev *dev);
<span class="lineNum">     899 </span>                :            : struct pci_driver *pci_dev_driver(const struct pci_dev *dev);
<span class="lineNum">     900 </span>                :            : int pci_add_dynid(struct pci_driver *drv,
<span class="lineNum">     901 </span>                :            :                   unsigned int vendor, unsigned int device,
<span class="lineNum">     902 </span>                :            :                   unsigned int subvendor, unsigned int subdevice,
<span class="lineNum">     903 </span>                :            :                   unsigned int class, unsigned int class_mask,
<span class="lineNum">     904 </span>                :            :                   unsigned long driver_data);
<span class="lineNum">     905 </span>                :            : const struct pci_device_id *pci_match_id(const struct pci_device_id *ids,
<span class="lineNum">     906 </span>                :            :                                          struct pci_dev *dev);
<span class="lineNum">     907 </span>                :            : int pci_scan_bridge(struct pci_bus *bus, struct pci_dev *dev, int max,
<span class="lineNum">     908 </span>                :            :                     int pass);
<span class="lineNum">     909 </span>                :            : 
<span class="lineNum">     910 </span>                :            : void pci_walk_bus(struct pci_bus *top, int (*cb)(struct pci_dev *, void *),
<span class="lineNum">     911 </span>                :            :                   void *userdata);
<span class="lineNum">     912 </span>                :            : int pci_cfg_space_size_ext(struct pci_dev *dev);
<span class="lineNum">     913 </span>                :            : int pci_cfg_space_size(struct pci_dev *dev);
<span class="lineNum">     914 </span>                :            : unsigned char pci_bus_max_busnr(struct pci_bus *bus);
<span class="lineNum">     915 </span>                :            : 
<span class="lineNum">     916 </span>                :            : int pci_set_vga_state(struct pci_dev *pdev, bool decode,
<span class="lineNum">     917 </span>                :            :                       unsigned int command_bits, bool change_bridge);
<span class="lineNum">     918 </span>                :            : /* kmem_cache style wrapper around pci_alloc_consistent() */
<span class="lineNum">     919 </span>                :            : 
<span class="lineNum">     920 </span>                :            : #include &lt;linux/pci-dma.h&gt;
<span class="lineNum">     921 </span>                :            : #include &lt;linux/dmapool.h&gt;
<span class="lineNum">     922 </span>                :            : 
<span class="lineNum">     923 </span>                :            : #define pci_pool dma_pool
<span class="lineNum">     924 </span>                :            : #define pci_pool_create(name, pdev, size, align, allocation) \
<span class="lineNum">     925 </span>                :            :                 dma_pool_create(name, &amp;pdev-&gt;dev, size, align, allocation)
<span class="lineNum">     926 </span>                :            : #define pci_pool_destroy(pool) dma_pool_destroy(pool)
<span class="lineNum">     927 </span>                :            : #define pci_pool_alloc(pool, flags, handle) dma_pool_alloc(pool, flags, handle)
<span class="lineNum">     928 </span>                :            : #define pci_pool_free(pool, vaddr, addr) dma_pool_free(pool, vaddr, addr)
<span class="lineNum">     929 </span>                :            : 
<span class="lineNum">     930 </span>                :            : enum pci_dma_burst_strategy {
<span class="lineNum">     931 </span>                :            :         PCI_DMA_BURST_INFINITY, /* make bursts as large as possible,
<span class="lineNum">     932 </span>                :            :                                    strategy_parameter is N/A */
<span class="lineNum">     933 </span>                :            :         PCI_DMA_BURST_BOUNDARY, /* disconnect at every strategy_parameter
<span class="lineNum">     934 </span>                :            :                                    byte boundaries */
<span class="lineNum">     935 </span>                :            :         PCI_DMA_BURST_MULTIPLE, /* disconnect at some multiple of
<span class="lineNum">     936 </span>                :            :                                    strategy_parameter byte boundaries */
<span class="lineNum">     937 </span>                :            : };
<span class="lineNum">     938 </span>                :            : 
<span class="lineNum">     939 </span>                :            : struct msix_entry {
<span class="lineNum">     940 </span>                :            :         u32     vector; /* kernel uses to write allocated vector */
<span class="lineNum">     941 </span>                :            :         u16     entry;  /* driver uses to specify entry, OS writes */
<span class="lineNum">     942 </span>                :            : };
<span class="lineNum">     943 </span>                :            : 
<span class="lineNum">     944 </span>                :            : 
<span class="lineNum">     945 </span>                :            : #ifndef CONFIG_PCI_MSI
<span class="lineNum">     946 </span>                :            : static inline int pci_enable_msi_block(struct pci_dev *dev, unsigned int nvec)
<span class="lineNum">     947 </span>                :            : {
<span class="lineNum">     948 </span>                :            :         return -1;
<span class="lineNum">     949 </span>                :            : }
<span class="lineNum">     950 </span>                :            : 
<span class="lineNum">     951 </span>                :            : static inline void pci_msi_shutdown(struct pci_dev *dev)
<span class="lineNum">     952 </span>                :            : { }
<span class="lineNum">     953 </span>                :            : static inline void pci_disable_msi(struct pci_dev *dev)
<span class="lineNum">     954 </span>                :            : { }
<span class="lineNum">     955 </span>                :            : 
<span class="lineNum">     956 </span>                :            : static inline int pci_msix_table_size(struct pci_dev *dev)
<span class="lineNum">     957 </span>                :            : {
<span class="lineNum">     958 </span>                :            :         return 0;
<span class="lineNum">     959 </span>                :            : }
<span class="lineNum">     960 </span>                :            : static inline int pci_enable_msix(struct pci_dev *dev,
<span class="lineNum">     961 </span>                :            :                                   struct msix_entry *entries, int nvec)
<span class="lineNum">     962 </span>                :            : {
<span class="lineNum">     963 </span>                :            :         return -1;
<span class="lineNum">     964 </span>                :            : }
<span class="lineNum">     965 </span>                :            : 
<span class="lineNum">     966 </span>                :            : static inline void pci_msix_shutdown(struct pci_dev *dev)
<span class="lineNum">     967 </span>                :            : { }
<span class="lineNum">     968 </span>                :            : static inline void pci_disable_msix(struct pci_dev *dev)
<span class="lineNum">     969 </span>                :            : { }
<span class="lineNum">     970 </span>                :            : 
<span class="lineNum">     971 </span>                :            : static inline void msi_remove_pci_irq_vectors(struct pci_dev *dev)
<span class="lineNum">     972 </span>                :            : { }
<span class="lineNum">     973 </span>                :            : 
<span class="lineNum">     974 </span>                :            : static inline void pci_restore_msi_state(struct pci_dev *dev)
<span class="lineNum">     975 </span>                :            : { }
<span class="lineNum">     976 </span>                :            : static inline int pci_msi_enabled(void)
<span class="lineNum">     977 </span>                :            : {
<span class="lineNum">     978 </span>                :            :         return 0;
<span class="lineNum">     979 </span>                :            : }
<span class="lineNum">     980 </span>                :            : #else
<span class="lineNum">     981 </span>                :            : extern int pci_enable_msi_block(struct pci_dev *dev, unsigned int nvec);
<span class="lineNum">     982 </span>                :            : extern void pci_msi_shutdown(struct pci_dev *dev);
<span class="lineNum">     983 </span>                :            : extern void pci_disable_msi(struct pci_dev *dev);
<span class="lineNum">     984 </span>                :            : extern int pci_msix_table_size(struct pci_dev *dev);
<span class="lineNum">     985 </span>                :            : extern int pci_enable_msix(struct pci_dev *dev,
<span class="lineNum">     986 </span>                :            :         struct msix_entry *entries, int nvec);
<span class="lineNum">     987 </span>                :            : extern void pci_msix_shutdown(struct pci_dev *dev);
<span class="lineNum">     988 </span>                :            : extern void pci_disable_msix(struct pci_dev *dev);
<span class="lineNum">     989 </span>                :            : extern void msi_remove_pci_irq_vectors(struct pci_dev *dev);
<span class="lineNum">     990 </span>                :            : extern void pci_restore_msi_state(struct pci_dev *dev);
<span class="lineNum">     991 </span>                :            : extern int pci_msi_enabled(void);
<span class="lineNum">     992 </span>                :            : #endif
<span class="lineNum">     993 </span>                :            : 
<span class="lineNum">     994 </span>                :            : #ifndef CONFIG_PCIEASPM
<span class="lineNum">     995 </span>                :            : static inline int pcie_aspm_enabled(void)
<span class="lineNum">     996 </span>                :            : {
<span class="lineNum">     997 </span>                :            :         return 0;
<span class="lineNum">     998 </span>                :            : }
<span class="lineNum">     999 </span>                :            : #else
<span class="lineNum">    1000 </span>                :            : extern int pcie_aspm_enabled(void);
<span class="lineNum">    1001 </span>                :            : #endif
<span class="lineNum">    1002 </span>                :            : 
<span class="lineNum">    1003 </span>                :            : #ifndef CONFIG_PCIE_ECRC
<span class="lineNum">    1004 </span>                :            : static inline void pcie_set_ecrc_checking(struct pci_dev *dev)
<span class="lineNum">    1005 </span>                :            : {
<span class="lineNum">    1006 </span>                :            :         return;
<span class="lineNum">    1007 </span>                :            : }
<span class="lineNum">    1008 </span>                :            : static inline void pcie_ecrc_get_policy(char *str) {};
<span class="lineNum">    1009 </span>                :            : #else
<span class="lineNum">    1010 </span>                :            : extern void pcie_set_ecrc_checking(struct pci_dev *dev);
<span class="lineNum">    1011 </span>                :            : extern void pcie_ecrc_get_policy(char *str);
<span class="lineNum">    1012 </span>                :            : #endif
<span class="lineNum">    1013 </span>                :            : 
<span class="lineNum">    1014 </span>                :            : #define pci_enable_msi(pdev)    pci_enable_msi_block(pdev, 1)
<span class="lineNum">    1015 </span>                :            : 
<span class="lineNum">    1016 </span>                :            : #ifdef CONFIG_HT_IRQ
<span class="lineNum">    1017 </span>                :            : /* The functions a driver should call */
<span class="lineNum">    1018 </span>                :            : int  ht_create_irq(struct pci_dev *dev, int idx);
<span class="lineNum">    1019 </span>                :            : void ht_destroy_irq(unsigned int irq);
<span class="lineNum">    1020 </span>                :            : #endif /* CONFIG_HT_IRQ */
<span class="lineNum">    1021 </span>                :            : 
<span class="lineNum">    1022 </span>                :            : extern void pci_block_user_cfg_access(struct pci_dev *dev);
<span class="lineNum">    1023 </span>                :            : extern void pci_unblock_user_cfg_access(struct pci_dev *dev);
<span class="lineNum">    1024 </span>                :            : 
<span class="lineNum">    1025 </span>                :            : /*
<span class="lineNum">    1026 </span>                :            :  * PCI domain support.  Sometimes called PCI segment (eg by ACPI),
<span class="lineNum">    1027 </span>                :            :  * a PCI domain is defined to be a set of PCI busses which share
<span class="lineNum">    1028 </span>                :            :  * configuration space.
<span class="lineNum">    1029 </span>                :            :  */
<span class="lineNum">    1030 </span>                :            : #ifdef CONFIG_PCI_DOMAINS
<span class="lineNum">    1031 </span>                :            : extern int pci_domains_supported;
<span class="lineNum">    1032 </span>                :            : #else
<span class="lineNum">    1033 </span>                :            : enum { pci_domains_supported = 0 };
<span class="lineNum">    1034 </span>                :            : static inline int pci_domain_nr(struct pci_bus *bus)
<span class="lineNum">    1035 </span>                :            : {
<span class="lineNum">    1036 </span>                :            :         return 0;
<span class="lineNum">    1037 </span>                :            : }
<span class="lineNum">    1038 </span>                :            : 
<span class="lineNum">    1039 </span>                :            : static inline int pci_proc_domain(struct pci_bus *bus)
<span class="lineNum">    1040 </span>                :            : {
<span class="lineNum">    1041 </span>                :            :         return 0;
<span class="lineNum">    1042 </span>                :            : }
<span class="lineNum">    1043 </span>                :            : #endif /* CONFIG_PCI_DOMAINS */
<span class="lineNum">    1044 </span>                :            : 
<span class="lineNum">    1045 </span>                :            : /* some architectures require additional setup to direct VGA traffic */
<span class="lineNum">    1046 </span>                :            : typedef int (*arch_set_vga_state_t)(struct pci_dev *pdev, bool decode,
<span class="lineNum">    1047 </span>                :            :                       unsigned int command_bits, bool change_bridge);
<span class="lineNum">    1048 </span>                :            : extern void pci_register_set_vga_state(arch_set_vga_state_t func);
<span class="lineNum">    1049 </span>                :            : 
<span class="lineNum">    1050 </span>                :            : #else /* CONFIG_PCI is not enabled */
<span class="lineNum">    1051 </span>                :            : 
<span class="lineNum">    1052 </span>                :            : /*
<span class="lineNum">    1053 </span>                :            :  *  If the system does not have PCI, clearly these return errors.  Define
<span class="lineNum">    1054 </span>                :            :  *  these as simple inline functions to avoid hair in drivers.
<span class="lineNum">    1055 </span>                :            :  */
<span class="lineNum">    1056 </span>                :            : 
<span class="lineNum">    1057 </span>                :            : #define _PCI_NOP(o, s, t) \
<span class="lineNum">    1058 </span>                :            :         static inline int pci_##o##_config_##s(struct pci_dev *dev, \
<span class="lineNum">    1059 </span>                :            :                                                 int where, t val) \
<span class="lineNum">    1060 </span>                :            :                 { return PCIBIOS_FUNC_NOT_SUPPORTED; }
<span class="lineNum">    1061 </span>                :            : 
<span class="lineNum">    1062 </span>                :            : #define _PCI_NOP_ALL(o, x)      _PCI_NOP(o, byte, u8 x) \
<span class="lineNum">    1063 </span>                :            :                                 _PCI_NOP(o, word, u16 x) \
<span class="lineNum">    1064 </span>                :            :                                 _PCI_NOP(o, dword, u32 x)
<span class="lineNum">    1065 </span>                :            : _PCI_NOP_ALL(read, *)
<span class="lineNum">    1066 </span>                :            : _PCI_NOP_ALL(write,)
<span class="lineNum">    1067 </span>                :            : 
<span class="lineNum">    1068 </span>                :            : static inline struct pci_dev *pci_get_device(unsigned int vendor,
<span class="lineNum">    1069 </span>                :            :                                              unsigned int device,
<span class="lineNum">    1070 </span>                :            :                                              struct pci_dev *from)
<span class="lineNum">    1071 </span>                :            : {
<span class="lineNum">    1072 </span>                :            :         return NULL;
<span class="lineNum">    1073 </span>                :            : }
<span class="lineNum">    1074 </span>                :            : 
<span class="lineNum">    1075 </span>                :            : static inline struct pci_dev *pci_get_subsys(unsigned int vendor,
<span class="lineNum">    1076 </span>                :            :                                              unsigned int device,
<span class="lineNum">    1077 </span>                :            :                                              unsigned int ss_vendor,
<span class="lineNum">    1078 </span>                :            :                                              unsigned int ss_device,
<span class="lineNum">    1079 </span>                :            :                                              struct pci_dev *from)
<span class="lineNum">    1080 </span>                :            : {
<span class="lineNum">    1081 </span>                :            :         return NULL;
<span class="lineNum">    1082 </span>                :            : }
<span class="lineNum">    1083 </span>                :            : 
<span class="lineNum">    1084 </span>                :            : static inline struct pci_dev *pci_get_class(unsigned int class,
<span class="lineNum">    1085 </span>                :            :                                             struct pci_dev *from)
<span class="lineNum">    1086 </span>                :            : {
<span class="lineNum">    1087 </span>                :            :         return NULL;
<span class="lineNum">    1088 </span>                :            : }
<span class="lineNum">    1089 </span>                :            : 
<span class="lineNum">    1090 </span>                :            : #define pci_dev_present(ids)    (0)
<span class="lineNum">    1091 </span>                :            : #define no_pci_devices()        (1)
<span class="lineNum">    1092 </span>                :            : #define pci_dev_put(dev)        do { } while (0)
<span class="lineNum">    1093 </span>                :            : 
<span class="lineNum">    1094 </span>                :            : static inline void pci_set_master(struct pci_dev *dev)
<span class="lineNum">    1095 </span>                :            : { }
<span class="lineNum">    1096 </span>                :            : 
<span class="lineNum">    1097 </span>                :            : static inline int pci_enable_device(struct pci_dev *dev)
<span class="lineNum">    1098 </span>                :            : {
<span class="lineNum">    1099 </span>                :            :         return -EIO;
<span class="lineNum">    1100 </span>                :            : }
<span class="lineNum">    1101 </span>                :            : 
<span class="lineNum">    1102 </span>                :            : static inline void pci_disable_device(struct pci_dev *dev)
<span class="lineNum">    1103 </span>                :            : { }
<span class="lineNum">    1104 </span>                :            : 
<span class="lineNum">    1105 </span>                :            : static inline int pci_set_dma_mask(struct pci_dev *dev, u64 mask)
<span class="lineNum">    1106 </span>                :            : {
<span class="lineNum">    1107 </span>                :            :         return -EIO;
<span class="lineNum">    1108 </span>                :            : }
<span class="lineNum">    1109 </span>                :            : 
<span class="lineNum">    1110 </span>                :            : static inline int pci_set_consistent_dma_mask(struct pci_dev *dev, u64 mask)
<span class="lineNum">    1111 </span>                :            : {
<span class="lineNum">    1112 </span>                :            :         return -EIO;
<span class="lineNum">    1113 </span>                :            : }
<span class="lineNum">    1114 </span>                :            : 
<span class="lineNum">    1115 </span>                :            : static inline int pci_set_dma_max_seg_size(struct pci_dev *dev,
<span class="lineNum">    1116 </span>                :            :                                         unsigned int size)
<span class="lineNum">    1117 </span>                :            : {
<span class="lineNum">    1118 </span>                :            :         return -EIO;
<span class="lineNum">    1119 </span>                :            : }
<span class="lineNum">    1120 </span>                :            : 
<span class="lineNum">    1121 </span>                :            : static inline int pci_set_dma_seg_boundary(struct pci_dev *dev,
<span class="lineNum">    1122 </span>                :            :                                         unsigned long mask)
<span class="lineNum">    1123 </span>                :            : {
<span class="lineNum">    1124 </span>                :            :         return -EIO;
<span class="lineNum">    1125 </span>                :            : }
<span class="lineNum">    1126 </span>                :            : 
<span class="lineNum">    1127 </span>                :            : static inline int pci_assign_resource(struct pci_dev *dev, int i)
<span class="lineNum">    1128 </span>                :            : {
<span class="lineNum">    1129 </span>                :            :         return -EBUSY;
<span class="lineNum">    1130 </span>                :            : }
<span class="lineNum">    1131 </span>                :            : 
<span class="lineNum">    1132 </span>                :            : static inline int __pci_register_driver(struct pci_driver *drv,
<span class="lineNum">    1133 </span>                :            :                                         struct module *owner)
<span class="lineNum">    1134 </span>                :            : {
<span class="lineNum">    1135 </span>                :            :         return 0;
<span class="lineNum">    1136 </span>                :            : }
<span class="lineNum">    1137 </span>                :            : 
<span class="lineNum">    1138 </span>                :            : static inline int pci_register_driver(struct pci_driver *drv)
<span class="lineNum">    1139 </span>                :            : {
<span class="lineNum">    1140 </span>                :            :         return 0;
<span class="lineNum">    1141 </span>                :            : }
<span class="lineNum">    1142 </span>                :            : 
<span class="lineNum">    1143 </span>                :            : static inline void pci_unregister_driver(struct pci_driver *drv)
<span class="lineNum">    1144 </span>                :            : { }
<span class="lineNum">    1145 </span>                :            : 
<span class="lineNum">    1146 </span>                :            : static inline int pci_find_capability(struct pci_dev *dev, int cap)
<span class="lineNum">    1147 </span>                :            : {
<span class="lineNum">    1148 </span>                :            :         return 0;
<span class="lineNum">    1149 </span>                :            : }
<span class="lineNum">    1150 </span>                :            : 
<span class="lineNum">    1151 </span>                :            : static inline int pci_find_next_capability(struct pci_dev *dev, u8 post,
<span class="lineNum">    1152 </span>                :            :                                            int cap)
<span class="lineNum">    1153 </span>                :            : {
<span class="lineNum">    1154 </span>                :            :         return 0;
<span class="lineNum">    1155 </span>                :            : }
<span class="lineNum">    1156 </span>                :            : 
<span class="lineNum">    1157 </span>                :            : static inline int pci_find_ext_capability(struct pci_dev *dev, int cap)
<span class="lineNum">    1158 </span>                :            : {
<span class="lineNum">    1159 </span>                :            :         return 0;
<span class="lineNum">    1160 </span>                :            : }
<span class="lineNum">    1161 </span>                :            : 
<span class="lineNum">    1162 </span>                :            : /* Power management related routines */
<span class="lineNum">    1163 </span>                :            : static inline int pci_save_state(struct pci_dev *dev)
<span class="lineNum">    1164 </span>                :            : {
<span class="lineNum">    1165 </span>                :            :         return 0;
<span class="lineNum">    1166 </span>                :            : }
<span class="lineNum">    1167 </span>                :            : 
<span class="lineNum">    1168 </span>                :            : static inline int pci_restore_state(struct pci_dev *dev)
<span class="lineNum">    1169 </span>                :            : {
<span class="lineNum">    1170 </span>                :            :         return 0;
<span class="lineNum">    1171 </span>                :            : }
<span class="lineNum">    1172 </span>                :            : 
<span class="lineNum">    1173 </span>                :            : static inline int pci_set_power_state(struct pci_dev *dev, pci_power_t state)
<span class="lineNum">    1174 </span>                :            : {
<span class="lineNum">    1175 </span>                :            :         return 0;
<span class="lineNum">    1176 </span>                :            : }
<span class="lineNum">    1177 </span>                :            : 
<span class="lineNum">    1178 </span>                :            : static inline pci_power_t pci_choose_state(struct pci_dev *dev,
<span class="lineNum">    1179 </span>                :            :                                            pm_message_t state)
<span class="lineNum">    1180 </span>                :            : {
<span class="lineNum">    1181 </span>                :            :         return PCI_D0;
<span class="lineNum">    1182 </span>                :            : }
<span class="lineNum">    1183 </span>                :            : 
<span class="lineNum">    1184 </span>                :            : static inline int pci_enable_wake(struct pci_dev *dev, pci_power_t state,
<span class="lineNum">    1185 </span>                :            :                                   int enable)
<span class="lineNum">    1186 </span>                :            : {
<span class="lineNum">    1187 </span>                :            :         return 0;
<span class="lineNum">    1188 </span>                :            : }
<span class="lineNum">    1189 </span>                :            : 
<span class="lineNum">    1190 </span>                :            : static inline int pci_request_regions(struct pci_dev *dev, const char *res_name)
<span class="lineNum">    1191 </span>                :            : {
<span class="lineNum">    1192 </span>                :            :         return -EIO;
<span class="lineNum">    1193 </span>                :            : }
<span class="lineNum">    1194 </span>                :            : 
<span class="lineNum">    1195 </span>                :            : static inline void pci_release_regions(struct pci_dev *dev)
<span class="lineNum">    1196 </span>                :            : { }
<span class="lineNum">    1197 </span>                :            : 
<span class="lineNum">    1198 </span>                :            : #define pci_dma_burst_advice(pdev, strat, strategy_parameter) do { } while (0)
<span class="lineNum">    1199 </span>                :            : 
<span class="lineNum">    1200 </span>                :            : static inline void pci_block_user_cfg_access(struct pci_dev *dev)
<span class="lineNum">    1201 </span>                :            : { }
<span class="lineNum">    1202 </span>                :            : 
<span class="lineNum">    1203 </span>                :            : static inline void pci_unblock_user_cfg_access(struct pci_dev *dev)
<span class="lineNum">    1204 </span>                :            : { }
<span class="lineNum">    1205 </span>                :            : 
<span class="lineNum">    1206 </span>                :            : static inline struct pci_bus *pci_find_next_bus(const struct pci_bus *from)
<span class="lineNum">    1207 </span>                :            : { return NULL; }
<span class="lineNum">    1208 </span>                :            : 
<span class="lineNum">    1209 </span>                :            : static inline struct pci_dev *pci_get_slot(struct pci_bus *bus,
<span class="lineNum">    1210 </span>                :            :                                                 unsigned int devfn)
<span class="lineNum">    1211 </span>                :            : { return NULL; }
<span class="lineNum">    1212 </span>                :            : 
<span class="lineNum">    1213 </span>                :            : static inline struct pci_dev *pci_get_bus_and_slot(unsigned int bus,
<span class="lineNum">    1214 </span>                :            :                                                 unsigned int devfn)
<span class="lineNum">    1215 </span>                :            : { return NULL; }
<span class="lineNum">    1216 </span>                :            : 
<span class="lineNum">    1217 </span>                :            : #define dev_is_pci(d) (false)
<span class="lineNum">    1218 </span>                :            : #define dev_is_pf(d) (false)
<span class="lineNum">    1219 </span>                :            : #define dev_num_vf(d) (0)
<span class="lineNum">    1220 </span>                :            : #endif /* CONFIG_PCI */
<span class="lineNum">    1221 </span>                :            : 
<span class="lineNum">    1222 </span>                :            : /* Include architecture-dependent settings and functions */
<span class="lineNum">    1223 </span>                :            : 
<span class="lineNum">    1224 </span>                :            : #include &lt;asm/pci.h&gt;
<span class="lineNum">    1225 </span>                :            : 
<span class="lineNum">    1226 </span>                :            : #ifndef PCIBIOS_MAX_MEM_32
<span class="lineNum">    1227 </span>                :            : #define PCIBIOS_MAX_MEM_32 (-1)
<span class="lineNum">    1228 </span>                :            : #endif
<span class="lineNum">    1229 </span>                :            : 
<span class="lineNum">    1230 </span>                :            : /* these helpers provide future and backwards compatibility
<span class="lineNum">    1231 </span>                :            :  * for accessing popular PCI BAR info */
<span class="lineNum">    1232 </span>                :            : #define pci_resource_start(dev, bar)    ((dev)-&gt;resource[(bar)].start)
<span class="lineNum">    1233 </span>                :            : #define pci_resource_end(dev, bar)      ((dev)-&gt;resource[(bar)].end)
<span class="lineNum">    1234 </span>                :            : #define pci_resource_flags(dev, bar)    ((dev)-&gt;resource[(bar)].flags)
<span class="lineNum">    1235 </span>                :            : #define pci_resource_len(dev,bar) \
<span class="lineNum">    1236 </span>                :            :         ((pci_resource_start((dev), (bar)) == 0 &amp;&amp;      \
<span class="lineNum">    1237 </span>                :            :           pci_resource_end((dev), (bar)) ==             \
<span class="lineNum">    1238 </span>                :            :           pci_resource_start((dev), (bar))) ? 0 :       \
<span class="lineNum">    1239 </span>                :            :                                                         \
<span class="lineNum">    1240 </span>                :            :          (pci_resource_end((dev), (bar)) -              \
<span class="lineNum">    1241 </span>                :            :           pci_resource_start((dev), (bar)) + 1))
<span class="lineNum">    1242 </span>                :            : 
<span class="lineNum">    1243 </span>                :            : /* Similar to the helpers above, these manipulate per-pci_dev
<span class="lineNum">    1244 </span>                :            :  * driver-specific data.  They are really just a wrapper around
<span class="lineNum">    1245 </span>                :            :  * the generic device structure functions of these calls.
<span class="lineNum">    1246 </span>                :            :  */
<span class="lineNum">    1247 </span>                :            : static inline void *pci_get_drvdata(struct pci_dev *pdev)
<span class="lineNum">    1248 </span>                :            : {
<span class="lineNum">    1249 </span>                :<span class="lineCov">         16 :         return dev_get_drvdata(&amp;pdev-&gt;dev);</span>
<span class="lineNum">    1250 </span>                :            : }
<span class="lineNum">    1251 </span>                :            : 
<span class="lineNum">    1252 </span>                :            : static inline void pci_set_drvdata(struct pci_dev *pdev, void *data)
<span class="lineNum">    1253 </span>                :            : {
<span class="lineNum">    1254 </span>                :<span class="lineCov">          6 :         dev_set_drvdata(&amp;pdev-&gt;dev, data);</span>
<span class="lineNum">    1255 </span>                :            : }
<span class="lineNum">    1256 </span>                :            : 
<span class="lineNum">    1257 </span>                :            : /* If you want to know what to call your pci_dev, ask this function.
<span class="lineNum">    1258 </span>                :            :  * Again, it's a wrapper around the generic device.
<span class="lineNum">    1259 </span>                :            :  */
<span class="lineNum">    1260 </span>                :            : static inline const char *pci_name(const struct pci_dev *pdev)
<span class="lineNum">    1261 </span>                :            : {
<span class="lineNum">    1262 </span>                :            :         return dev_name(&amp;pdev-&gt;dev);
<span class="lineNum">    1263 </span>                :            : }
<span class="lineNum">    1264 </span>                :            : 
<span class="lineNum">    1265 </span>                :            : 
<span class="lineNum">    1266 </span>                :            : /* Some archs don't want to expose struct resource to userland as-is
<span class="lineNum">    1267 </span>                :            :  * in sysfs and /proc
<span class="lineNum">    1268 </span>                :            :  */
<span class="lineNum">    1269 </span>                :            : #ifndef HAVE_ARCH_PCI_RESOURCE_TO_USER
<span class="lineNum">    1270 </span>                :            : static inline void pci_resource_to_user(const struct pci_dev *dev, int bar,
<span class="lineNum">    1271 </span>                :            :                 const struct resource *rsrc, resource_size_t *start,
<span class="lineNum">    1272 </span>                :            :                 resource_size_t *end)
<span class="lineNum">    1273 </span>                :            : {
<span class="lineNum">    1274 </span>                :            :         *start = rsrc-&gt;start;
<span class="lineNum">    1275 </span>                :            :         *end = rsrc-&gt;end;
<span class="lineNum">    1276 </span>                :            : }
<span class="lineNum">    1277 </span>                :            : #endif /* HAVE_ARCH_PCI_RESOURCE_TO_USER */
<span class="lineNum">    1278 </span>                :            : 
<span class="lineNum">    1279 </span>                :            : 
<span class="lineNum">    1280 </span>                :            : /*
<span class="lineNum">    1281 </span>                :            :  *  The world is not perfect and supplies us with broken PCI devices.
<span class="lineNum">    1282 </span>                :            :  *  For at least a part of these bugs we need a work-around, so both
<span class="lineNum">    1283 </span>                :            :  *  generic (drivers/pci/quirks.c) and per-architecture code can define
<span class="lineNum">    1284 </span>                :            :  *  fixup hooks to be called for particular buggy devices.
<span class="lineNum">    1285 </span>                :            :  */
<span class="lineNum">    1286 </span>                :            : 
<span class="lineNum">    1287 </span>                :            : struct pci_fixup {
<span class="lineNum">    1288 </span>                :            :         u16 vendor, device;     /* You can use PCI_ANY_ID here of course */
<span class="lineNum">    1289 </span>                :            :         void (*hook)(struct pci_dev *dev);
<span class="lineNum">    1290 </span>                :            : };
<span class="lineNum">    1291 </span>                :            : 
<span class="lineNum">    1292 </span>                :            : enum pci_fixup_pass {
<span class="lineNum">    1293 </span>                :            :         pci_fixup_early,        /* Before probing BARs */
<span class="lineNum">    1294 </span>                :            :         pci_fixup_header,       /* After reading configuration header */
<span class="lineNum">    1295 </span>                :            :         pci_fixup_final,        /* Final phase of device fixups */
<span class="lineNum">    1296 </span>                :            :         pci_fixup_enable,       /* pci_enable_device() time */
<span class="lineNum">    1297 </span>                :            :         pci_fixup_resume,       /* pci_device_resume() */
<span class="lineNum">    1298 </span>                :            :         pci_fixup_suspend,      /* pci_device_suspend */
<span class="lineNum">    1299 </span>                :            :         pci_fixup_resume_early, /* pci_device_resume_early() */
<span class="lineNum">    1300 </span>                :            : };
<span class="lineNum">    1301 </span>                :            : 
<span class="lineNum">    1302 </span>                :            : /* Anonymous variables would be nice... */
<span class="lineNum">    1303 </span>                :            : #define DECLARE_PCI_FIXUP_SECTION(section, name, vendor, device, hook)  \
<span class="lineNum">    1304 </span>                :            :         static const struct pci_fixup __pci_fixup_##name __used         \
<span class="lineNum">    1305 </span>                :            :         __attribute__((__section__(#section))) = { vendor, device, hook };
<span class="lineNum">    1306 </span>                :            : #define DECLARE_PCI_FIXUP_EARLY(vendor, device, hook)                   \
<span class="lineNum">    1307 </span>                :            :         DECLARE_PCI_FIXUP_SECTION(.pci_fixup_early,                     \
<span class="lineNum">    1308 </span>                :            :                         vendor##device##hook, vendor, device, hook)
<span class="lineNum">    1309 </span>                :            : #define DECLARE_PCI_FIXUP_HEADER(vendor, device, hook)                  \
<span class="lineNum">    1310 </span>                :            :         DECLARE_PCI_FIXUP_SECTION(.pci_fixup_header,                    \
<span class="lineNum">    1311 </span>                :            :                         vendor##device##hook, vendor, device, hook)
<span class="lineNum">    1312 </span>                :            : #define DECLARE_PCI_FIXUP_FINAL(vendor, device, hook)                   \
<span class="lineNum">    1313 </span>                :            :         DECLARE_PCI_FIXUP_SECTION(.pci_fixup_final,                     \
<span class="lineNum">    1314 </span>                :            :                         vendor##device##hook, vendor, device, hook)
<span class="lineNum">    1315 </span>                :            : #define DECLARE_PCI_FIXUP_ENABLE(vendor, device, hook)                  \
<span class="lineNum">    1316 </span>                :            :         DECLARE_PCI_FIXUP_SECTION(.pci_fixup_enable,                    \
<span class="lineNum">    1317 </span>                :            :                         vendor##device##hook, vendor, device, hook)
<span class="lineNum">    1318 </span>                :            : #define DECLARE_PCI_FIXUP_RESUME(vendor, device, hook)                  \
<span class="lineNum">    1319 </span>                :            :         DECLARE_PCI_FIXUP_SECTION(.pci_fixup_resume,                    \
<span class="lineNum">    1320 </span>                :            :                         resume##vendor##device##hook, vendor, device, hook)
<span class="lineNum">    1321 </span>                :            : #define DECLARE_PCI_FIXUP_RESUME_EARLY(vendor, device, hook)            \
<span class="lineNum">    1322 </span>                :            :         DECLARE_PCI_FIXUP_SECTION(.pci_fixup_resume_early,              \
<span class="lineNum">    1323 </span>                :            :                         resume_early##vendor##device##hook, vendor, device, hook)
<span class="lineNum">    1324 </span>                :            : #define DECLARE_PCI_FIXUP_SUSPEND(vendor, device, hook)                 \
<span class="lineNum">    1325 </span>                :            :         DECLARE_PCI_FIXUP_SECTION(.pci_fixup_suspend,                   \
<span class="lineNum">    1326 </span>                :            :                         suspend##vendor##device##hook, vendor, device, hook)
<span class="lineNum">    1327 </span>                :            : 
<span class="lineNum">    1328 </span>                :            : #ifdef CONFIG_PCI_QUIRKS
<span class="lineNum">    1329 </span>                :            : void pci_fixup_device(enum pci_fixup_pass pass, struct pci_dev *dev);
<span class="lineNum">    1330 </span>                :            : #else
<span class="lineNum">    1331 </span>                :            : static inline void pci_fixup_device(enum pci_fixup_pass pass,
<span class="lineNum">    1332 </span>                :            :                                     struct pci_dev *dev) {}
<span class="lineNum">    1333 </span>                :            : #endif
<span class="lineNum">    1334 </span>                :            : 
<span class="lineNum">    1335 </span>                :            : void __iomem *pcim_iomap(struct pci_dev *pdev, int bar, unsigned long maxlen);
<span class="lineNum">    1336 </span>                :            : void pcim_iounmap(struct pci_dev *pdev, void __iomem *addr);
<span class="lineNum">    1337 </span>                :            : void __iomem * const *pcim_iomap_table(struct pci_dev *pdev);
<span class="lineNum">    1338 </span>                :            : int pcim_iomap_regions(struct pci_dev *pdev, u16 mask, const char *name);
<span class="lineNum">    1339 </span>                :            : int pcim_iomap_regions_request_all(struct pci_dev *pdev, u16 mask,
<span class="lineNum">    1340 </span>                :            :                                    const char *name);
<span class="lineNum">    1341 </span>                :            : void pcim_iounmap_regions(struct pci_dev *pdev, u16 mask);
<span class="lineNum">    1342 </span>                :            : 
<span class="lineNum">    1343 </span>                :            : extern int pci_pci_problems;
<span class="lineNum">    1344 </span>                :            : #define PCIPCI_FAIL             1       /* No PCI PCI DMA */
<span class="lineNum">    1345 </span>                :            : #define PCIPCI_TRITON           2
<span class="lineNum">    1346 </span>                :            : #define PCIPCI_NATOMA           4
<span class="lineNum">    1347 </span>                :            : #define PCIPCI_VIAETBF          8
<span class="lineNum">    1348 </span>                :            : #define PCIPCI_VSFX             16
<span class="lineNum">    1349 </span>                :            : #define PCIPCI_ALIMAGIK         32      /* Need low latency setting */
<span class="lineNum">    1350 </span>                :            : #define PCIAGP_FAIL             64      /* No PCI to AGP DMA */
<span class="lineNum">    1351 </span>                :            : 
<span class="lineNum">    1352 </span>                :            : extern unsigned long pci_cardbus_io_size;
<span class="lineNum">    1353 </span>                :            : extern unsigned long pci_cardbus_mem_size;
<span class="lineNum">    1354 </span>                :            : extern u8 __devinitdata pci_dfl_cache_line_size;
<span class="lineNum">    1355 </span>                :            : extern u8 pci_cache_line_size;
<span class="lineNum">    1356 </span>                :            : 
<span class="lineNum">    1357 </span>                :            : extern unsigned long pci_hotplug_io_size;
<span class="lineNum">    1358 </span>                :            : extern unsigned long pci_hotplug_mem_size;
<span class="lineNum">    1359 </span>                :            : 
<span class="lineNum">    1360 </span>                :            : int pcibios_add_platform_entries(struct pci_dev *dev);
<span class="lineNum">    1361 </span>                :            : void pcibios_disable_device(struct pci_dev *dev);
<span class="lineNum">    1362 </span>                :            : int pcibios_set_pcie_reset_state(struct pci_dev *dev,
<span class="lineNum">    1363 </span>                :            :                                  enum pcie_reset_state state);
<span class="lineNum">    1364 </span>                :            : 
<span class="lineNum">    1365 </span>                :            : #ifdef CONFIG_PCI_MMCONFIG
<span class="lineNum">    1366 </span>                :            : extern void __init pci_mmcfg_early_init(void);
<span class="lineNum">    1367 </span>                :            : extern void __init pci_mmcfg_late_init(void);
<span class="lineNum">    1368 </span>                :            : #else
<span class="lineNum">    1369 </span>                :            : static inline void pci_mmcfg_early_init(void) { }
<span class="lineNum">    1370 </span>                :            : static inline void pci_mmcfg_late_init(void) { }
<span class="lineNum">    1371 </span>                :            : #endif
<span class="lineNum">    1372 </span>                :            : 
<span class="lineNum">    1373 </span>                :            : int pci_ext_cfg_avail(struct pci_dev *dev);
<span class="lineNum">    1374 </span>                :            : 
<span class="lineNum">    1375 </span>                :            : void __iomem *pci_ioremap_bar(struct pci_dev *pdev, int bar);
<span class="lineNum">    1376 </span>                :            : 
<span class="lineNum">    1377 </span>                :            : #ifdef CONFIG_PCI_IOV
<span class="lineNum">    1378 </span>                :            : extern int pci_enable_sriov(struct pci_dev *dev, int nr_virtfn);
<span class="lineNum">    1379 </span>                :            : extern void pci_disable_sriov(struct pci_dev *dev);
<span class="lineNum">    1380 </span>                :            : extern irqreturn_t pci_sriov_migration(struct pci_dev *dev);
<span class="lineNum">    1381 </span>                :            : extern int pci_num_vf(struct pci_dev *dev);
<span class="lineNum">    1382 </span>                :            : #else
<span class="lineNum">    1383 </span>                :            : static inline int pci_enable_sriov(struct pci_dev *dev, int nr_virtfn)
<span class="lineNum">    1384 </span>                :            : {
<span class="lineNum">    1385 </span>                :            :         return -ENODEV;
<span class="lineNum">    1386 </span>                :            : }
<span class="lineNum">    1387 </span>                :            : static inline void pci_disable_sriov(struct pci_dev *dev)
<span class="lineNum">    1388 </span>                :            : {
<span class="lineNum">    1389 </span>                :            : }
<span class="lineNum">    1390 </span>                :            : static inline irqreturn_t pci_sriov_migration(struct pci_dev *dev)
<span class="lineNum">    1391 </span>                :            : {
<span class="lineNum">    1392 </span>                :            :         return IRQ_NONE;
<span class="lineNum">    1393 </span>                :            : }
<span class="lineNum">    1394 </span>                :            : static inline int pci_num_vf(struct pci_dev *dev)
<span class="lineNum">    1395 </span>                :            : {
<span class="lineNum">    1396 </span>                :            :         return 0;
<span class="lineNum">    1397 </span>                :            : }
<span class="lineNum">    1398 </span>                :            : #endif
<span class="lineNum">    1399 </span>                :            : 
<span class="lineNum">    1400 </span>                :            : #if defined(CONFIG_HOTPLUG_PCI) || defined(CONFIG_HOTPLUG_PCI_MODULE)
<span class="lineNum">    1401 </span>                :            : extern void pci_hp_create_module_link(struct pci_slot *pci_slot);
<span class="lineNum">    1402 </span>                :            : extern void pci_hp_remove_module_link(struct pci_slot *pci_slot);
<span class="lineNum">    1403 </span>                :            : #endif
<span class="lineNum">    1404 </span>                :            : 
<span class="lineNum">    1405 </span>                :            : /**
<span class="lineNum">    1406 </span>                :            :  * pci_pcie_cap - get the saved PCIe capability offset
<span class="lineNum">    1407 </span>                :            :  * @dev: PCI device
<span class="lineNum">    1408 </span>                :            :  *
<span class="lineNum">    1409 </span>                :            :  * PCIe capability offset is calculated at PCI device initialization
<span class="lineNum">    1410 </span>                :            :  * time and saved in the data structure. This function returns saved
<span class="lineNum">    1411 </span>                :            :  * PCIe capability offset. Using this instead of pci_find_capability()
<span class="lineNum">    1412 </span>                :            :  * reduces unnecessary search in the PCI configuration space. If you
<span class="lineNum">    1413 </span>                :            :  * need to calculate PCIe capability offset from raw device for some
<span class="lineNum">    1414 </span>                :            :  * reasons, please use pci_find_capability() instead.
<span class="lineNum">    1415 </span>                :            :  */
<span class="lineNum">    1416 </span>                :            : static inline int pci_pcie_cap(struct pci_dev *dev)
<span class="lineNum">    1417 </span>                :            : {
<span class="lineNum">    1418 </span>                :            :         return dev-&gt;pcie_cap;
<span class="lineNum">    1419 </span>                :            : }
<span class="lineNum">    1420 </span>                :            : 
<span class="lineNum">    1421 </span>                :            : /**
<span class="lineNum">    1422 </span>                :            :  * pci_is_pcie - check if the PCI device is PCI Express capable
<span class="lineNum">    1423 </span>                :            :  * @dev: PCI device
<span class="lineNum">    1424 </span>                :            :  *
<span class="lineNum">    1425 </span>                :            :  * Retrun true if the PCI device is PCI Express capable, false otherwise.
<span class="lineNum">    1426 </span>                :            :  */
<span class="lineNum">    1427 </span>                :            : static inline bool pci_is_pcie(struct pci_dev *dev)
<span class="lineNum">    1428 </span>                :            : {
<span class="lineNum">    1429 </span>                :            :         return !!pci_pcie_cap(dev);
<span class="lineNum">    1430 </span>                :            : }
<span class="lineNum">    1431 </span>                :            : 
<span class="lineNum">    1432 </span>                :            : void pci_request_acs(void);
<span class="lineNum">    1433 </span>                :            : 
<span class="lineNum">    1434 </span>                :            : 
<span class="lineNum">    1435 </span>                :            : #define PCI_VPD_LRDT                    0x80    /* Large Resource Data Type */
<span class="lineNum">    1436 </span>                :            : #define PCI_VPD_LRDT_ID(x)              (x | PCI_VPD_LRDT)
<span class="lineNum">    1437 </span>                :            : 
<span class="lineNum">    1438 </span>                :            : /* Large Resource Data Type Tag Item Names */
<span class="lineNum">    1439 </span>                :            : #define PCI_VPD_LTIN_ID_STRING          0x02    /* Identifier String */
<span class="lineNum">    1440 </span>                :            : #define PCI_VPD_LTIN_RO_DATA            0x10    /* Read-Only Data */
<span class="lineNum">    1441 </span>                :            : #define PCI_VPD_LTIN_RW_DATA            0x11    /* Read-Write Data */
<span class="lineNum">    1442 </span>                :            : 
<span class="lineNum">    1443 </span>                :            : #define PCI_VPD_LRDT_ID_STRING          PCI_VPD_LRDT_ID(PCI_VPD_LTIN_ID_STRING)
<span class="lineNum">    1444 </span>                :            : #define PCI_VPD_LRDT_RO_DATA            PCI_VPD_LRDT_ID(PCI_VPD_LTIN_RO_DATA)
<span class="lineNum">    1445 </span>                :            : #define PCI_VPD_LRDT_RW_DATA            PCI_VPD_LRDT_ID(PCI_VPD_LTIN_RW_DATA)
<span class="lineNum">    1446 </span>                :            : 
<span class="lineNum">    1447 </span>                :            : /* Small Resource Data Type Tag Item Names */
<span class="lineNum">    1448 </span>                :            : #define PCI_VPD_STIN_END                0x78    /* End */
<span class="lineNum">    1449 </span>                :            : 
<span class="lineNum">    1450 </span>                :            : #define PCI_VPD_SRDT_END                PCI_VPD_STIN_END
<span class="lineNum">    1451 </span>                :            : 
<span class="lineNum">    1452 </span>                :            : #define PCI_VPD_SRDT_TIN_MASK           0x78
<span class="lineNum">    1453 </span>                :            : #define PCI_VPD_SRDT_LEN_MASK           0x07
<span class="lineNum">    1454 </span>                :            : 
<span class="lineNum">    1455 </span>                :            : #define PCI_VPD_LRDT_TAG_SIZE           3
<span class="lineNum">    1456 </span>                :            : #define PCI_VPD_SRDT_TAG_SIZE           1
<span class="lineNum">    1457 </span>                :            : 
<span class="lineNum">    1458 </span>                :            : #define PCI_VPD_INFO_FLD_HDR_SIZE       3
<span class="lineNum">    1459 </span>                :            : 
<span class="lineNum">    1460 </span>                :            : #define PCI_VPD_RO_KEYWORD_PARTNO       &quot;PN&quot;
<span class="lineNum">    1461 </span>                :            : #define PCI_VPD_RO_KEYWORD_MFR_ID       &quot;MN&quot;
<span class="lineNum">    1462 </span>                :            : #define PCI_VPD_RO_KEYWORD_VENDOR0      &quot;V0&quot;
<span class="lineNum">    1463 </span>                :            : 
<span class="lineNum">    1464 </span>                :            : /**
<span class="lineNum">    1465 </span>                :            :  * pci_vpd_lrdt_size - Extracts the Large Resource Data Type length
<span class="lineNum">    1466 </span>                :            :  * @lrdt: Pointer to the beginning of the Large Resource Data Type tag
<span class="lineNum">    1467 </span>                :            :  *
<span class="lineNum">    1468 </span>                :            :  * Returns the extracted Large Resource Data Type length.
<span class="lineNum">    1469 </span>                :            :  */
<span class="lineNum">    1470 </span>                :            : static inline u16 pci_vpd_lrdt_size(const u8 *lrdt)
<span class="lineNum">    1471 </span>                :            : {
<span class="lineNum">    1472 </span>                :            :         return (u16)lrdt[1] + ((u16)lrdt[2] &lt;&lt; 8);
<span class="lineNum">    1473 </span>                :            : }
<span class="lineNum">    1474 </span>                :            : 
<span class="lineNum">    1475 </span>                :            : /**
<span class="lineNum">    1476 </span>                :            :  * pci_vpd_srdt_size - Extracts the Small Resource Data Type length
<span class="lineNum">    1477 </span>                :            :  * @lrdt: Pointer to the beginning of the Small Resource Data Type tag
<span class="lineNum">    1478 </span>                :            :  *
<span class="lineNum">    1479 </span>                :            :  * Returns the extracted Small Resource Data Type length.
<span class="lineNum">    1480 </span>                :            :  */
<span class="lineNum">    1481 </span>                :            : static inline u8 pci_vpd_srdt_size(const u8 *srdt)
<span class="lineNum">    1482 </span>                :            : {
<span class="lineNum">    1483 </span>                :            :         return (*srdt) &amp; PCI_VPD_SRDT_LEN_MASK;
<span class="lineNum">    1484 </span>                :            : }
<span class="lineNum">    1485 </span>                :            : 
<span class="lineNum">    1486 </span>                :            : /**
<span class="lineNum">    1487 </span>                :            :  * pci_vpd_info_field_size - Extracts the information field length
<span class="lineNum">    1488 </span>                :            :  * @lrdt: Pointer to the beginning of an information field header
<span class="lineNum">    1489 </span>                :            :  *
<span class="lineNum">    1490 </span>                :            :  * Returns the extracted information field length.
<span class="lineNum">    1491 </span>                :            :  */
<span class="lineNum">    1492 </span>                :            : static inline u8 pci_vpd_info_field_size(const u8 *info_field)
<span class="lineNum">    1493 </span>                :            : {
<span class="lineNum">    1494 </span>                :            :         return info_field[2];
<span class="lineNum">    1495 </span>                :            : }
<span class="lineNum">    1496 </span>                :            : 
<span class="lineNum">    1497 </span>                :            : /**
<span class="lineNum">    1498 </span>                :            :  * pci_vpd_find_tag - Locates the Resource Data Type tag provided
<span class="lineNum">    1499 </span>                :            :  * @buf: Pointer to buffered vpd data
<span class="lineNum">    1500 </span>                :            :  * @off: The offset into the buffer at which to begin the search
<span class="lineNum">    1501 </span>                :            :  * @len: The length of the vpd buffer
<span class="lineNum">    1502 </span>                :            :  * @rdt: The Resource Data Type to search for
<span class="lineNum">    1503 </span>                :            :  *
<span class="lineNum">    1504 </span>                :            :  * Returns the index where the Resource Data Type was found or
<span class="lineNum">    1505 </span>                :            :  * -ENOENT otherwise.
<span class="lineNum">    1506 </span>                :            :  */
<span class="lineNum">    1507 </span>                :            : int pci_vpd_find_tag(const u8 *buf, unsigned int off, unsigned int len, u8 rdt);
<span class="lineNum">    1508 </span>                :            : 
<span class="lineNum">    1509 </span>                :            : /**
<span class="lineNum">    1510 </span>                :            :  * pci_vpd_find_info_keyword - Locates an information field keyword in the VPD
<span class="lineNum">    1511 </span>                :            :  * @buf: Pointer to buffered vpd data
<span class="lineNum">    1512 </span>                :            :  * @off: The offset into the buffer at which to begin the search
<span class="lineNum">    1513 </span>                :            :  * @len: The length of the buffer area, relative to off, in which to search
<span class="lineNum">    1514 </span>                :            :  * @kw: The keyword to search for
<span class="lineNum">    1515 </span>                :            :  *
<span class="lineNum">    1516 </span>                :            :  * Returns the index where the information field keyword was found or
<span class="lineNum">    1517 </span>                :            :  * -ENOENT otherwise.
<span class="lineNum">    1518 </span>                :            :  */
<span class="lineNum">    1519 </span>                :            : int pci_vpd_find_info_keyword(const u8 *buf, unsigned int off,
<span class="lineNum">    1520 </span>                :            :                               unsigned int len, const char *kw);
<span class="lineNum">    1521 </span>                :            : 
<span class="lineNum">    1522 </span>                :            : #endif /* __KERNEL__ */
<span class="lineNum">    1523 </span>                :            : #endif /* LINUX_PCI_H */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.8</a></td></tr>
  </table>
  <br>

</body>
</html>
